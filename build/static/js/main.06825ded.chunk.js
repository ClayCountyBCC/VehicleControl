(this.webpackJsonpvehiclecontrol=this.webpackJsonpvehiclecontrol||[]).push([[0],{15:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(8),i=a.n(c),l=a(3),s=a(2),o={map:null,map_view:null,unit_groups:[],current_view:"unit",avl_data:new Array,fc_data:new Array,cad_data:new Array,unit_data:new Array,filtered_avl_data:new Array,filtered_fc_data:new Array,filtered_cad_data:new Array,filtered_unit_data:new Array,avl_data_filter:"",fc_data_filter:"",cad_data_filter:"",unit_data_filter:"",avl_data_sort_field:"device_id",fc_data_sort_field:"device_id",cad_data_sort_field:"unitcode",unit_data_sort_field:"unitcode",avl_data_sort_ascending:!0,fc_data_sort_ascending:!0,cad_data_sort_ascending:!0,unit_data_sort_ascending:!0,avl_data_special_filter:"",fc_data_special_filter:"",cad_data_special_filter:"",unit_data_special_filter:""},d=r.a.createContext(o);function u(e,t){switch(t.type){case"save_map":return Object(s.a)({},e,{map:t.payload});case"save_map_view":return Object(s.a)({},e,{map_view:t.payload});case"get_unit_groups_data":return Object(s.a)({},e,{unit_groups:t.payload});case"set_current_view":return Object(s.a)({},e,{current_view:t.payload});case"view_avl_by_unit":return Object(s.a)({},e,{current_view:"avl",filtered_avl_data:m(e.avl_data,t.payload,e.avl_data_sort_field,e.avl_data_sort_ascending,e.avl_data_special_filter),avl_data_special_filter:"",avl_data_filter:t.payload});case"view_fc_by_unit":return Object(s.a)({},e,{current_view:"fc",filtered_fc_data:p(e.fc_data,t.payload,e.fc_data_sort_field,e.fc_data_sort_ascending,e.fc_data_special_filter),fc_data_special_filter:"",fc_data_filter:t.payload});case"view_cad_by_unit":return Object(s.a)({},e,{current_view:"cad",filtered_cad_data:v(e.cad_data,t.payload,e.cad_data_sort_field,e.cad_data_sort_ascending,e.cad_data_special_filter),cad_data_special_filter:"",cad_data_filter:t.payload});case"get_avl_data":return Object(s.a)({},e,{avl_data:t.payload,filtered_avl_data:m(t.payload,e.avl_data_filter,e.avl_data_sort_field,e.avl_data_sort_ascending,e.avl_data_special_filter)});case"get_fc_data":return Object(s.a)({},e,{fc_data:t.payload,filtered_fc_data:p(t.payload,e.fc_data_filter,e.fc_data_sort_field,e.fc_data_sort_ascending,e.fc_data_special_filter)});case"get_cad_data":return Object(s.a)({},e,{cad_data:t.payload,filtered_cad_data:p(t.payload,e.cad_data_filter,e.cad_data_sort_field,e.cad_data_sort_ascending,e.cad_data_special_filter)});case"get_unit_data":return Object(s.a)({},e,{unit_data:t.payload,filtered_unit_data:h(t.payload,e.unit_data_filter,e.unit_data_sort_field,e.unit_data_sort_ascending,e.unit_data_special_filter)});case"search_avl_data":return Object(s.a)({},e,{filtered_avl_data:m(e.avl_data,t.payload,e.avl_data_sort_field,e.avl_data_sort_ascending,e.avl_data_special_filter),avl_data_filter:t.payload});case"search_fc_data":return Object(s.a)({},e,{filtered_fc_data:p(e.fc_data,t.payload,e.fc_data_sort_field,e.fc_data_sort_ascending,e.fc_data_special_filter),fc_data_filter:t.payload});case"search_cad_data":return Object(s.a)({},e,{filtered_cad_data:v(e.cad_data,t.payload,e.cad_data_sort_field,e.cad_data_sort_ascending,e.cad_data_special_filter),cad_data_filter:t.payload});case"search_unit_data":return Object(s.a)({},e,{filtered_unit_data:h(e.unit_data,t.payload,e.unit_data_sort_field,e.unit_data_sort_ascending,e.unit_data_special_filter),unit_data_filter:t.payload});case"avl_device_history":var a=e.filtered_avl_data.map((function(e){return e.device_id===t.payload.device_id&&(e.device_history=t.payload.device_history),e}));return Object(s.a)({},e,{filtered_avl_data:a});case"fc_device_history":var n=e.filtered_fc_data.map((function(e){return e.device_id===t.payload.device_id&&(e.device_history=t.payload.device_history),e}));return Object(s.a)({},e,{filtered_fc_data:n});case"cad_device_history":var r=e.filtered_cad_data.map((function(e){return e.unitcode===t.payload.unitcode&&(e.device_history=t.payload.device_history),e}));return Object(s.a)({},e,{filtered_cad_data:r});case"unit_device_history":var c=e.filtered_unit_data.map((function(e){return e.unitcode===t.payload.unitcode&&(e.device_history=t.payload.device_history),e}));return Object(s.a)({},e,{filtered_unit_data:c});case"avl_data_special_filter":return Object(s.a)({},e,{filtered_avl_data:m(e.avl_data,e.avl_data_filter,e.avl_data_sort_field,e.avl_data_sort_ascending,t.payload),avl_data_special_filter:t.payload});case"fc_data_special_filter":return Object(s.a)({},e,{filtered_fc_data:p(e.fc_data,e.fc_data_filter,e.fc_data_sort_field,e.fc_data_sort_ascending,t.payload),fc_data_special_filter:t.payload});case"cad_data_special_filter":return Object(s.a)({},e,{filtered_cad_data:v(e.cad_data,e.cad_data_filter,e.cad_data_sort_field,e.cad_data_sort_ascending,t.payload),cad_data_special_filter:t.payload});case"unit_data_special_filter":return Object(s.a)({},e,{filtered_unit_data:v(e.unit_data,e.unit_data_filter,e.unit_data_sort_field,e.unit_data_sort_ascending,t.payload),unit_data_special_filter:t.payload});case"avl_data_sort":var i=f(e.filtered_avl_data,t.payload,!e.avl_data_sort_ascending);return Object(s.a)({},e,{filtered_avl_data:i,avl_data_sort_field:t.payload,avl_data_sort_ascending:!e.avl_data_sort_ascending});case"fc_data_sort":var l=f(e.filtered_fc_data,t.payload,!e.fc_data_sort_ascending);return Object(s.a)({},e,{filtered_fc_data:l,fc_data_sort_field:t.payload,fc_data_sort_ascending:!e.fc_data_sort_ascending});case"cad_data_sort":var o=f(e.filtered_cad_data,t.payload,!e.cad_data_sort_ascending);return Object(s.a)({},e,{filtered_cad_data:o,cad_data_sort_field:t.payload,cad_data_sort_ascending:!e.cad_data_sort_ascending});case"unit_data_sort":var d=f(e.filtered_unit_data,t.payload,!e.unit_data_sort_ascending);return Object(s.a)({},e,{filtered_unit_data:d,unit_data_sort_field:t.payload,unit_data_sort_ascending:!e.unit_data_sort_ascending});case"avl_data_toggle_show_errors":var u=e.filtered_avl_data.map((function(e){return e.device_id===t.payload&&(e.show_errors=!e.show_errors),e}));return Object(s.a)({},e,{filtered_avl_data:u});case"fc_data_toggle_show_errors":var _=e.filtered_fc_data.map((function(e){return e.device_id===t.payload&&(e.show_errors=!e.show_errors),e}));return Object(s.a)({},e,{filtered_fc_data:_});case"cad_data_toggle_show_errors":var y=e.filtered_cad_data.map((function(e){return e.unitcode===t.payload&&(e.show_errors=!e.show_errors),e}));return Object(s.a)({},e,{filtered_cad_data:y});case"unit_data_toggle_show_errors":var g=e.filtered_unit_data.map((function(e){return e.unitcode===t.payload&&(e.show_errors=!e.show_errors),e}));return Object(s.a)({},e,{filtered_unit_data:g});case"avl_data_toggle_show_unit_options":var E=e.filtered_avl_data.map((function(e){return e.device_id===t.payload&&(e.show_unit_options=!e.show_unit_options),e}));return Object(s.a)({},e,{filtered_avl_data:E});case"fc_data_toggle_show_unit_options":var w=e.filtered_fc_data.map((function(e){return e.device_id===t.payload&&(e.show_unit_options=!e.show_unit_options),e}));return Object(s.a)({},e,{filtered_fc_data:w});case"unit_data_toggle_show_unit_options":var b=e.filtered_unit_data.map((function(e){return e.unitcode===t.payload&&(e.show_unit_options=!e.show_unit_options),e}));return Object(s.a)({},e,{filtered_unit_data:b});default:return e}}function _(e,t){if(0===t.length)return e;switch(t){case"error":return e.filter((function(e){return e.error_information.length>0}));case"asset_tag":return e.filter((function(e){return e.has_asset_tag_error}));case"date":return e.filter((function(e){return e.has_date_error}));case"location":return e.filter((function(e){return e.has_location_error}));case"unit":return e.filter((function(e){return e.has_unit_error}));case"cad":return e.filter((function(e){return e.has_cad_error}));case"avl":return e.filter((function(e){return e.has_avl_error}));case"fc":return e.filter((function(e){return e.has_fc_error}));default:return e}}function f(e,t,a){return["updated_on","location_timestamp"].indexOf(t)>-1?function(e,t,a){return e.sort((function(e,n){return new Date(e[t])>new Date(n[t])?a?1:-1:new Date(n[t])>new Date(e[t])?a?-1:1:0}))}(e,t,a):e.sort((function(e,n){return e[t]>n[t]?a?1:-1:n[t]>e[t]?a?-1:1:0}))}function m(e,t,a,n,r){return f(_(function(e,t){if(0===t.length)return e;var a=t.toLowerCase().split(",");return e.filter((function(e){var t=!1,n=!0,r=!1,c=void 0;try{for(var i,l=a[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var s=i.value;if(s=s.trim(),t=e.unitcode.toLowerCase().indexOf(s)>-1||e.device_id.toLowerCase().indexOf(s)>-1)break}}catch(o){r=!0,c=o}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return t}))}(e,t),r),a,n)}function p(e,t,a,n,r){return f(_(function(e,t){if(0===t.length)return e;var a=t.toLowerCase().split(",");return e.filter((function(e){var t=!1,n=!0,r=!1,c=void 0;try{for(var i,l=a[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var s=i.value;if(s=s.trim(),t=e.unitcode.toLowerCase().indexOf(s)>-1||e.device_id.toLowerCase().indexOf(s)>-1||e.asset_tag.toLowerCase().indexOf(s)>-1)break}}catch(o){r=!0,c=o}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return t}))}(e,t),r),a,n)}function v(e,t,a,n,r){return f(_(function(e,t){if(0===t.length)return e;var a=t.toLowerCase().split(",");return e.filter((function(e){var t=!1,n=!0,r=!1,c=void 0;try{for(var i,l=a[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var s=i.value;if(s=s.trim(),t=e.unitcode.toLowerCase().indexOf(s)>-1)break}}catch(o){r=!0,c=o}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return t}))}(e,t),r),a,n)}function h(e,t,a,n,r){return f(_(function(e,t){if(0===t.length)return e;var a=t.toLowerCase().split(","),n=t.toLowerCase();return e.filter((function(e){var t=!1,r=!0,c=!1,i=void 0;try{for(var l,s=a[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var o=l.value;if(o=o.trim(),t=e.unitcode.toLowerCase().indexOf(o)>-1||e.group_label.toLowerCase().indexOf(o)>-1||e.using_unit.toLowerCase().indexOf(n)>-1)break}}catch(d){c=!0,i=d}finally{try{r||null==s.return||s.return()}finally{if(c)throw i}}return t}))}(e,t),r),a,n)}var y=a(1),g=a.n(y),E=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,n=function(){var e=document.getElementById("nav_basemap_dropdown");null!==e&&e.classList.remove("is-active")};return r.a.createElement("nav",{className:"navbar is-primary",role:"navigation","aria-label":"main navigation"},r.a.createElement("div",{className:"navbar-brand"},r.a.createElement("h1",{className:"navbar-item is-size-3 has-text-weight-bold"},"Vehicle Control")),r.a.createElement("div",{className:"navbar-menu"},r.a.createElement("div",{className:"navbar-start"},r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"unit"})},className:"navbar-item is-tab cursor_pointer ".concat("unit"===t.current_view?"is-active":""," ")},"Units"),r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"avl"})},className:"navbar-item is-tab cursor_pointer ".concat("avl"===t.current_view?"is-active":""," ")},"AVL"),r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"fc"})},className:"navbar-item is-tab cursor_pointer ".concat("fc"===t.current_view?"is-active":""," ")},"Fleet Complete"),r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"cad"})},className:"navbar-item is-tab cursor_pointer ".concat("cad"===t.current_view?"is-active":""," ")},"CAD"),r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"map"})},className:"navbar-item is-tab cursor_pointer ".concat("map"===t.current_view?"is-active":""," ")},"Map")),r.a.createElement("div",{style:{paddingRight:"4em"},className:"navbar-end"},r.a.createElement("div",{id:"nav_basemap_dropdown",className:"navbar-item has-dropdown"},r.a.createElement("a",{className:"navbar-link",onClick:function(e){var t=document.getElementById("nav_basemap_dropdown");if(null!==t){var a=t.classList.contains("is-active");document.querySelectorAll(".esri-basemap-gallery__item").forEach((function(e){a?e.removeEventListener("click",n):e.addEventListener("click",n)})),t.classList.toggle("is-active")}}},"Select Base Map"),r.a.createElement("div",{id:"basemap-navbar-dropdown",className:"navbar-dropdown"},r.a.createElement("div",{className:"navbar-item"},r.a.createElement("div",{id:"basemap_selector_container"})))),r.a.createElement("div",{id:"nav_layerlist_dropdown",className:"navbar-item has-dropdown"},r.a.createElement("a",{className:"navbar-link",onClick:function(e){var t=document.getElementById("nav_layerlist_dropdown");null!==t&&t.classList.toggle("is-active")}},"View Layers"),r.a.createElement("div",{className:"navbar-dropdown"},r.a.createElement("div",{className:"navbar-item"},r.a.createElement("div",{id:"layerlist_selector_container"})))),r.a.createElement("p",{className:"navbar-item"}))))},w=a(4),b=a(5);function x(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"}));case 2:if((t=a.sent).ok){a.next=5;break}throw new Error(t.statusText);case 5:return a.next=7,g.a.awrap(t.json());case 7:return a.abrupt("return",a.sent);case 8:case"end":return a.stop()}}))}function N(e,t){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.a.awrap(fetch(e,{method:"POST",body:null!==t?JSON.stringify(t):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}));case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}))}function k(e){return e instanceof Date?e.toLocaleString("en-us"):new Date(e).toLocaleString("en-US")}var C=function(){function e(){Object(w.a)(this,e),this.device_id="",this.device_type="",this.unitcode="",this.direction=0,this.location_timestamp=new Date,this.satellite_count=0,this.velocity=0,this.latitude=0,this.longitude=0,this.updated_on=new Date,this.error_information=[],this.show_unit_options=!1,this.show_errors=!1,this.has_date_error=!1,this.has_location_error=!1,this.has_unit_error=!1,this.device_history=[]}return Object(b.a)(e,null,[{key:"Get",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(x("API/AVL/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(N("API/AVL/Delete?device_id="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"Update",value:function(e,t,a){var n;return g.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,g.a.awrap(N("API/AVL/Update?device_id=".concat(e,"&device_type=").concat(t,"&unitcode=").concat(a),{}));case 2:return n=r.sent,r.abrupt("return",n);case 4:case"end":return r.stop()}}))}}]),e}(),D=function(e){return e.show_errors?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:e.colspan-1},r.a.createElement("ul",null,e.error_information.map((function(e,t){return r.a.createElement("li",{key:t},e)}))))):null},O=function(e){var t=Object(n.useState)(""),a=Object(l.a)(t,2),c=a[0],i=a[1];return e.show_unit_options?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Current Unit:"),r.a.createElement("td",null,0===e.unitcode.length?"None":e.unitcode),r.a.createElement("td",{className:"has-text-right"},"Change To:"),r.a.createElement("td",{colSpan:2},r.a.createElement("div",{className:"field has-addons"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input is-small",type:"text",onChange:function(e){return i(e.target.value)},value:c,placeholder:"New Unit"})),r.a.createElement("div",{className:"control"},r.a.createElement("button",{type:"button",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:t.preventDefault(),console.log("props asset_tag",e.asset_tag),e.asset_tag?e.update_data(e.asset_tag,c.trim()):e.update_data(e.device_id,e.device_type,c.trim());case 3:case"end":return a.stop()}}))},className:"button is-success is-small"},"Save"))))):null},S=function(){function e(){Object(w.a)(this,e),this.id=-1,this.unitcode="",this.field="",this.changed_from="",this.changed_to="",this.changed_on=new Date,this.changed_by="",this.error_message=""}return Object(b.a)(e,null,[{key:"GetByUnit",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(x("API/History/Unit?unit="+e));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"GetByDeviceId",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(x("API/History/DeviceId?deviceId="+e));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}}]),e}(),j=function(e){return e.history&&0!==e.history.length?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:e.colspan-1},r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"has-text-centered",colSpan:e.colspan},e.title)),r.a.createElement("tr",null,r.a.createElement("th",null,"Unitcode"),r.a.createElement("th",null,"Field"),r.a.createElement("th",null,"Changed From"),r.a.createElement("th",null,"Changed To"),r.a.createElement("th",null,"Changed On"),r.a.createElement("th",null,"Changed By"))),r.a.createElement("tbody",null,e.history.map((function(e){return e.error_message.length>0?r.a.createElement("tr",{key:e.id},r.a.createElement("td",{colSpan:6},e.error_message)):r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,e.unitcode),r.a.createElement("td",null,e.field),r.a.createElement("td",null,e.changed_from),r.a.createElement("td",null,e.changed_to),r.a.createElement("td",null,k(e.changed_on)),r.a.createElement("td",null,e.changed_by))})))))):null},A=function(e){var t=r.a.useContext(d),a=t.state,n=t.dispatch,c=function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(C.Get());case 2:return e=t.sent,t.abrupt("return",n({type:"get_avl_data",payload:e}));case 4:case"end":return t.stop()}}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,e.device_id,0!==e.latitude?r.a.createElement("span",{title:"View this on the Map",style:{color:"rgb(225,0,0)"},className:"icon cursor_pointer",onClick:function(t){!function(e,t){if(a.map_view){var n={type:"point",longitude:e,latitude:t};a.map_view.center=n,a.map_view.zoom<18&&(a.map_view.zoom=18)}}(e.longitude,e.latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):""),r.a.createElement("td",null,r.a.createElement("span",{className:"icon"},r.a.createElement("i",{className:"fas ".concat("Phone Number"===e.device_type?"fa-phone":"fa-sim-card")}))),r.a.createElement("td",null,r.a.createElement("span",{title:"Change this Device's unit",className:"cursor_pointer has-text-link",onClick:function(t){n({type:"avl_data_toggle_show_unit_options",payload:e.device_id})}},0===e.unitcode.length?"Add":e.unitcode)),r.a.createElement("td",null,k(e.updated_on)),r.a.createElement("td",null,k(e.location_timestamp)),r.a.createElement("td",{className:"has-text-right icon-options"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(t){n({type:"avl_data_toggle_show_errors",payload:e.device_id})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",onClick:function(t){var a;return g.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.preventDefault(),e.device_history&&0!==e.device_history.length){r.next=8;break}return r.next=4,g.a.awrap(S.GetByDeviceId(e.device_id));case 4:a=r.sent,n({type:"avl_device_history",payload:{device_id:e.device_id,device_history:a}}),r.next=9;break;case 8:n({type:"avl_device_history",payload:{device_id:e.device_id,device_history:[]}});case 9:case"end":return r.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),r.a.createElement("span",{title:"Delete This Device",className:"icon cursor_pointer has-text-danger",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(C.Delete(e.device_id));case 3:a.sent.ok?c():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})))),r.a.createElement(O,Object.assign({colspan:7,new_unitcode:"",update_data:function(e,t,a){return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.a.awrap(C.Update(e,t,a));case 2:n.sent.ok?c():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 4:case"end":return n.stop()}}))}},e)),r.a.createElement(D,{colspan:7,error_information:e.error_information,show_errors:e.show_errors}),r.a.createElement(j,{colspan:7,title:"History By Device Id",history:e.device_history}))},L=function(e,t,a){var c=r.a.useContext(d).dispatch,i=Object(n.useState)(!1),s=Object(l.a)(i,2),o=s[0],u=s[1],_=Object(n.useState)(!1),f=Object(l.a)(_,2),m=f[0],p=f[1],v=function(){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return p(!1),u(!0),n.prev=2,n.next=5,g.a.awrap(e());case 5:a=n.sent,c({type:t,payload:a}),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(2),p(!0),console.log("error in useFetchData",n.t0);case 13:u(!1);case 14:case"end":return n.stop()}}),null,null,[[2,9]])};return Object(n.useEffect)((function(){a&&v()}),[]),{isLoading:o,isError:m,fetchData:v}},U=function(e){var t=e.title,a=e.title_description,c=e.search_type,i=e.loading,s=e.fetchData,o=e.data_filter,u=e.special_filter,_=e.header_filters,f=r.a.useContext(d),m=f.state,p=f.dispatch,v=Object(n.useState)(o||""),h=Object(l.a)(v,2),y=h[0],g=h[1];return Object(n.useEffect)((function(){}),[i,o,u]),r.a.createElement("div",{style:{padding:"1em",marginBottom:0},className:"level"},r.a.createElement("div",{className:"level-left"},r.a.createElement("div",{className:"level-item is-size-3 has-text-weight-bold"},t),r.a.createElement("div",{className:"level-item"},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control ".concat(i?"is-loading":"")},r.a.createElement("input",{className:"input is-small",title:a,type:"text",placeholder:"Search",onChange:function(e){return g(e.target.value)},value:y,onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),p({type:c,payload:y}))}})))),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(e){e.preventDefault(),s()},title:"Refresh data",type:"button",className:"button is-success is-small ".concat(i?"is-loading":"")},r.a.createElement("span",{className:"icon is-small"},r.a.createElement("i",{className:"fas fa-sync-alt"}))),r.a.createElement("button",{style:{marginLeft:".5em"},onClick:function(e){e.preventDefault(),e.stopPropagation(),g(""),p({type:c,payload:""})},title:"Reset the Search",type:"button",className:"button is-warning is-small"},r.a.createElement("span",{className:"icon is-small"},r.a.createElement("i",{className:"fas fa-undo-alt"}))))),r.a.createElement("div",{className:"level-right"},r.a.createElement("p",{className:"level-item has-text-weight-bold"},"Filters"),r.a.createElement("div",{className:"level-item tabs"},r.a.createElement("ul",null,_.map((function(e){return r.a.createElement("li",{className:"".concat(m[u]===e.value?"is-active":""),key:e.id},r.a.createElement("a",{onClick:function(t){return p({type:u,payload:e.value})}},e.label))}))))))},I=U,G=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,c=L(C.Get,"get_avl_data",!1),i=c.isLoading,l=c.isError,s=function(e,t,a){return{loading:e,title:"AVL",title_description:"Search for text in the Device Id and Unit fields. Search for multiple items by separating with comma. Hit Enter to Search.",search_type:"search_avl_data",fetchData:t,data_filter:a,special_filter:"avl_data_special_filter",header_filters:[{id:0,label:"Show All",value:""},{id:1,label:"All Errors",value:"error"},{id:2,label:"Unit",value:"unit"},{id:3,label:"Date",value:"date"},{id:4,label:"Location",value:"location"}]}}(i,c.fetchData,t.avl_data_filter);return Object(n.useEffect)((function(){}),[i,l,t.filtered_avl_data,t.avl_data_filter,t.avl_data_sort_field,t.avl_data_sort_ascending,t.avl_data_special_filter]),r.a.createElement("section",null,r.a.createElement(I,Object.assign({loading:i},s)),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"#"),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDeviceId",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"device_id"})},className:"".concat("device_id"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Device Id")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDeviceType",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"device_type"})},className:"".concat("device_type"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Type")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnit",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"unitcode"})},className:"".concat("unitcode"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Unit")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDateSavedOn",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"updated_on"})},className:"".concat("updated_on"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Data Saved On")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByLocationDate",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"location_timestamp"})},className:"".concat("location_timestamp"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Location On")),r.a.createElement("th",{className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,t.filtered_avl_data.map((function(e,t){return r.a.createElement(A,Object.assign({key:e.device_id,index:t},e))})))))},B=function(){function e(){Object(w.a)(this,e),this.device_id="",this.asset_tag="",this.unitcode="",this.vin="",this.make="",this.model="",this.vehicle_year="",this.direction=0,this.location_timestamp=new Date,this.updated_on=new Date,this.velocity=0,this.latitude=0,this.longitude=0,this.error_information=[],this.show_unit_options=!1,this.show_errors=!1,this.has_date_error=!1,this.has_location_error=!1,this.has_asset_tag_error=!1,this.has_unit_error=!1,this.device_history=[]}return Object(b.a)(e,null,[{key:"Get",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(x("API/FC/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(N("API/FC/Delete?device_id="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"Update",value:function(e,t){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.a.awrap(N("API/FC/Update?asset_tag=".concat(e,"&unitcode=").concat(t),{}));case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}))}}]),e}(),V=function(e){var t=r.a.useContext(d),a=t.state,n=t.dispatch,c=function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(B.Get());case 2:return e=t.sent,t.abrupt("return",n({type:"get_fc_data",payload:e}));case 4:case"end":return t.stop()}}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,e.device_id.replace(/^0+/,""),0!==e.latitude?r.a.createElement("span",{title:"View this on the Map",className:"icon cursor_pointer",style:{color:"rgb(0,225,0)"},onClick:function(t){!function(e,t){if(a.map_view){var n={type:"point",longitude:e,latitude:t};a.map_view.center=n,a.map_view.zoom<18&&(a.map_view.zoom=18)}}(e.longitude,e.latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):""),r.a.createElement("td",null,e.asset_tag===e.device_id?"":e.asset_tag),r.a.createElement("td",null,r.a.createElement("span",{title:"Change this Device's unit",className:"cursor_pointer has-text-link",onClick:function(t){n({type:"fc_data_toggle_show_unit_options",payload:e.device_id})}},0===e.unitcode.length?"Add":e.unitcode)),r.a.createElement("td",null,k(e.updated_on)),r.a.createElement("td",null,k(e.location_timestamp)),r.a.createElement("td",{className:"has-text-right icon-options"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(t){n({type:"fc_data_toggle_show_errors",payload:e.device_id})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",onClick:function(t){var a;return g.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.preventDefault(),e.device_history&&0!==e.device_history.length){r.next=8;break}return r.next=4,g.a.awrap(S.GetByDeviceId(e.asset_tag));case 4:a=r.sent,n({type:"fc_device_history",payload:{device_id:e.device_id,device_history:a}}),r.next=9;break;case 8:n({type:"fc_device_history",payload:{device_id:e.device_id,device_history:[]}});case 9:case"end":return r.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),r.a.createElement("span",{title:"Delete This Device",className:"icon cursor_pointer has-text-danger",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(B.Delete(e.device_id));case 3:a.sent.ok?c():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})))),r.a.createElement(O,Object.assign({colspan:7,new_unitcode:"",update_data:function(e,t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(B.Update(e,t));case 2:a.sent.ok?c():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 4:case"end":return a.stop()}}))}},e)),r.a.createElement(D,{colspan:7,error_information:e.error_information,show_errors:e.show_errors}),r.a.createElement(j,{colspan:7,title:"History By Device Id",history:e.device_history}))},F=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,c=L(B.Get,"get_fc_data",!1),i=c.isLoading,l=c.isError,s=function(e,t,a){return{loading:e,title:"FC",title_description:"Search for text in the Device Id, Unit, and Asset Tag fields. Search for multiple items by separating with comma. Hit Enter to Search.",search_type:"search_fc_data",fetchData:t,data_filter:a,special_filter:"fc_data_special_filter",header_filters:[{id:0,label:"Show All",value:""},{id:1,label:"Errors",value:"error"},{id:2,label:"Asset Tag",value:"asset_tag"},{id:3,label:"Unit",value:"unit"},{id:4,label:"Date",value:"date"},{id:5,label:"Location",value:"location"}]}}(i,c.fetchData,t.fc_data_filter);return Object(n.useEffect)((function(){}),[i,l,t.filtered_fc_data,t.fc_data_filter,t.fc_data_sort_field,t.fc_data_sort_ascending,t.fc_data_special_filter]),r.a.createElement("section",null,r.a.createElement(U,Object.assign({loading:i},s)),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{width:"5%"}},"#"),r.a.createElement("th",{style:{width:"15%"}},r.a.createElement("a",{href:"#SortByDeviceId",onClick:function(e){e.preventDefault(),a({type:"fc_data_sort",payload:"device_id"})},className:"".concat("device_id"!==t.fc_data_sort_field?"":t.fc_data_sort_ascending?"sort_ascending":"sort_descending")},"Device Id")),r.a.createElement("th",{style:{width:"10%"}},r.a.createElement("a",{href:"#SortByAssetTag",onClick:function(e){e.preventDefault(),a({type:"fc_data_sort",payload:"asset_tag"})},className:"".concat("asset_tag"!==t.fc_data_sort_field?"":t.fc_data_sort_ascending?"sort_ascending":"sort_descending")},"Asset Tag")),r.a.createElement("th",{style:{width:"8%"}},r.a.createElement("a",{href:"#SortByUnit",onClick:function(e){e.preventDefault(),a({type:"fc_data_sort",payload:"unitcode"})},className:"".concat("unitcode"!==t.fc_data_sort_field?"":t.fc_data_sort_ascending?"sort_ascending":"sort_descending")},"Unit")),r.a.createElement("th",{style:{width:"24%"}},r.a.createElement("a",{href:"#SortByDateSavedOn",onClick:function(e){e.preventDefault(),a({type:"fc_data_sort",payload:"updated_on"})},className:"".concat("updated_on"!==t.fc_data_sort_field?"":t.fc_data_sort_ascending?"sort_ascending":"sort_descending")},"Data Saved On")),r.a.createElement("th",{style:{width:"24%"}},r.a.createElement("a",{href:"#SortByLocationDate",onClick:function(e){e.preventDefault(),a({type:"fc_data_sort",payload:"location_timestamp"})},className:"".concat("location_timestamp"!==t.fc_data_sort_field?"":t.fc_data_sort_ascending?"sort_ascending":"sort_descending")},"Location On")),r.a.createElement("th",{style:{width:"14%"},className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,t.filtered_fc_data.map((function(e,t){return r.a.createElement(V,Object.assign({key:e.device_id,index:t},e))})))))},T=function(){function e(){Object(w.a)(this,e),this.unitcode="",this.location_timestamp=new Date,this.inci_id="",this.status="",this.avstatus="",this.latitude=0,this.longitude=0,this.speed=0,this.heading=0,this.updated_on=new Date,this.error_information=[],this.show_unit_options=!1,this.show_errors=!1,this.has_date_error=!1,this.has_location_error=!1,this.has_unit_error=!1,this.device_history=[]}return Object(b.a)(e,null,[{key:"Get",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(x("API/CAD/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(N("API/CAD/Delete?unitcode="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}}]),e}(),P=function(e){var t=r.a.useContext(d),a=t.state,n=t.dispatch,c=function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(T.Get());case 2:return e=t.sent,t.abrupt("return",n({type:"get_cad_data",payload:e}));case 4:case"end":return t.stop()}}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,e.unitcode,0!==e.latitude?r.a.createElement("span",{title:"View this on the Map",style:{color:"rgb(0,0,225)"},className:"icon cursor_pointer",onClick:function(t){!function(e,t){if(a.map_view){var n={type:"point",longitude:e,latitude:t};a.map_view.center=n,a.map_view.zoom<18&&(a.map_view.zoom=18)}}(e.longitude,e.latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):""),r.a.createElement("td",null,e.inci_id.trim().length>0?"On A Call":""),r.a.createElement("td",null,e.status),r.a.createElement("td",null,e.avstatus),r.a.createElement("td",null,k(e.updated_on)),r.a.createElement("td",null,k(e.location_timestamp)),r.a.createElement("td",{className:"has-text-right icon-options"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(t){n({type:"cad_data_toggle_show_errors",payload:e.unitcode})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",onClick:function(t){var a;return g.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.preventDefault(),e.device_history&&0!==e.device_history.length){r.next=8;break}return r.next=4,g.a.awrap(S.GetByDeviceId(e.unitcode));case 4:a=r.sent,n({type:"cad_device_history",payload:{unitcode:e.unitcode,device_history:a}}),r.next=9;break;case 8:n({type:"cad_device_history",payload:{unitcode:e.unitcode,device_history:[]}});case 9:case"end":return r.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),r.a.createElement("span",{title:"Delete This Device",className:"icon cursor_pointer has-text-danger",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(T.Delete(e.unitcode));case 3:a.sent.ok?c():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})))),r.a.createElement(D,{colspan:8,error_information:e.error_information,show_errors:e.show_errors}),r.a.createElement(j,{colspan:8,title:"History By Device Id",history:e.device_history}))},M=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,c=L(T.Get,"get_cad_data",!1),i=c.isLoading,l=c.isError,s=function(e,t,a){return{loading:e,title:"CAD",title_description:"Search for text in the UnitCode field. Search for multiple items by separating with comma. Hit Enter to Search.",search_type:"search_cad_data",fetchData:t,data_filter:a,special_filter:"cad_data_special_filter",header_filters:[{id:0,label:"Show All",value:""},{id:1,label:"Errors",value:"error"},{id:3,label:"Date",value:"date"},{id:4,label:"Location",value:"location"}]}}(i,c.fetchData,t.cad_data_filter);return Object(n.useEffect)((function(){}),[i,l,t.filtered_cad_data,t.cad_data_filter,t.cad_data_sort_field,t.cad_data_sort_ascending,t.cad_data_special_filter]),r.a.createElement("section",null,r.a.createElement(U,Object.assign({loading:i},s)),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"#"),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnitCode",onClick:function(e){e.preventDefault(),a({type:"cad_data_sort",payload:"unitcode"})},className:"".concat("unitcode"!==t.cad_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Unit Code")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByCallStatus",onClick:function(e){e.preventDefault(),a({type:"cad_data_sort",payload:"inci_id"})},className:"".concat("inci_id"!==t.cad_data_sort_field?"":t.cad_data_sort_ascending?"sort_ascending":"sort_descending")},"Call Status")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnitStatus",onClick:function(e){e.preventDefault(),a({type:"cad_data_sort",payload:"status"})},className:"".concat("status"!==t.cad_data_sort_field?"":t.cad_data_sort_ascending?"sort_ascending":"sort_descending")},"Status")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnitAVStatus",onClick:function(e){e.preventDefault(),a({type:"cad_data_sort",payload:"avstatus"})},className:"".concat("avstatus"!==t.cad_data_sort_field?"":t.cad_data_sort_ascending?"sort_ascending":"sort_descending")},"AV Status")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDateSavedOn",onClick:function(e){e.preventDefault(),a({type:"cad_data_sort",payload:"updated_on"})},className:"".concat("updated_on"!==t.cad_data_sort_field?"":t.cad_data_sort_ascending?"sort_ascending":"sort_descending")},"Data Saved On")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByLocationDate",onClick:function(e){e.preventDefault(),a({type:"cad_data_sort",payload:"location_timestamp"})},className:"".concat("location_timestamp"!==t.cad_data_sort_field?"":t.cad_data_sort_ascending?"sort_ascending":"sort_descending")},"Location On")),r.a.createElement("th",{className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,t.filtered_cad_data.map((function(e,t){return r.a.createElement(P,Object.assign({key:e.unitcode,index:t},e))})))))},H=function(){function e(){Object(w.a)(this,e),this.unitcode="",this.using_unit="",this.group_label="",this.show_in_minicad=!1,this.avl_longitude=0,this.avl_latitude=0,this.avl_location_timestamp=new Date,this.has_avl_device=!1,this.has_avl_error=!1,this.fc_longitude=0,this.fc_latitude=0,this.fc_location_timestamp=new Date,this.has_fc_device=!1,this.has_fc_error=!1,this.cad_longitude=0,this.cad_latitude=0,this.cad_location_timestamp=new Date,this.should_have_cad_location=!1,this.has_cad_error=!1,this.error_information=[],this.show_errors=!1,this.show_unit_options=!1,this.device_history=[]}return Object(b.a)(e,null,[{key:"Get",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(x("API/Unit/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(N("API/Unit/Delete?unitcode="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"Update",value:function(e,t,a,n,r){var c;return g.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,g.a.awrap(N("API/Unit/Update?unitcode=".concat(e,"&group=").concat(t,"&has_avl=").concat(a,"&has_fc=").concat(n,"&should_have_cad=").concat(r),{}));case 2:return c=i.sent,i.abrupt("return",c);case 4:case"end":return i.stop()}}))}},{key:"Add",value:function(e,t,a,n,r){var c;return g.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,g.a.awrap(N("API/Unit/Add?unitcode=".concat(e,"&group=").concat(t,"&has_avl=").concat(a,"&has_fc=").concat(n,"&should_have_cad=").concat(r),{}));case 2:return c=i.sent,i.abrupt("return",c);case 4:case"end":return i.stop()}}))}}]),e}(),z=function(e){var t=r.a.useContext(d),a=t.state,c=t.dispatch,i=Object(n.useState)(e.unitcode),s=Object(l.a)(i,2),o=(s[0],s[1],Object(n.useState)(function(e){if(0===e.length)return e;var t=a.unit_groups.filter((function(t){return t.label===e}));return t.length>0?t[0].value:""}(e.group_label))),u=Object(l.a)(o,2),_=u[0],f=u[1],m=Object(n.useState)(e.has_avl_device),p=Object(l.a)(m,2),v=p[0],h=p[1],y=Object(n.useState)(e.has_fc_device),E=Object(l.a)(y,2),w=E[0],b=E[1],x=Object(n.useState)(e.should_have_cad_location),N=Object(l.a)(x,2),k=N[0],C=N[1];return e.show_unit_options?r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Group:"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select is-small"},r.a.createElement("select",{value:_,onChange:function(e){f(e.target.value)}},r.a.createElement("option",{value:""},"No Group"),a.unit_groups.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)}))))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Has AVL Device"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:v,onChange:function(e){return h(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Has Fleet Complete Device"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:w,onChange:function(e){return b(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Should Have CAD Location"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:k,onChange:function(e){return C(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:3}),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(H.Update(e.unitcode,_,v,w,k));case 3:a.sent.ok?e.refresh_data():alert("There was a problem updating this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))},title:"This will save all of the selections above",className:"is-success button is-small"},"Save"),r.a.createElement("button",{title:"Close the Unit Options menu without saving any changes",style:{marginLeft:"1em"},className:"is-warning button is-small",onClick:function(t){c({type:"unit_data_toggle_show_unit_options",payload:e.unitcode})}},"Cancel")))),r.a.createElement("td",{colSpan:4}))):null},R=function(e){var t=r.a.useContext(d),a=t.state,n=t.dispatch,c=function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(H.Get());case 2:return e=t.sent,t.abrupt("return",n({type:"get_unit_data",payload:e}));case 4:case"end":return t.stop()}}))},i=function(e,t){if(console.log("lat/long",t,e),a.map_view){var n={type:"point",longitude:e,latitude:t};a.map_view.center=n,a.map_view.zoom<18&&(a.map_view.zoom=18)}};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,r.a.createElement("span",{title:"Change this Unit's Information",className:"cursor_pointer has-text-link",onClick:function(t){n({type:"unit_data_toggle_show_unit_options",payload:e.unitcode})}},e.unitcode)),r.a.createElement("td",null,e.using_unit),r.a.createElement("td",null,e.group_label),r.a.createElement("td",null,0!==e.avl_latitude?r.a.createElement("span",{title:"View this on the Map",style:{color:"rgb(225,0,0)"},className:"icon cursor_pointer",onClick:function(t){i(e.avl_longitude,e.avl_latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):"",new Date(e.avl_location_timestamp).getFullYear()>1995?r.a.createElement("span",{style:{marginLeft:".5em",color:"rgb(225, 0, 0)"},title:"View this on the AVL Menu",className:"icon cursor_pointer",onClick:function(t){n({type:"view_avl_by_unit",payload:e.unitcode})}},r.a.createElement("i",{className:"fas fa-edit"})):""),r.a.createElement("td",null,0!==e.fc_latitude?r.a.createElement("span",{title:"View this on the Map",className:"icon cursor_pointer",style:{color:"rgb(0,225,0)"},onClick:function(t){i(e.fc_longitude,e.fc_latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):"",new Date(e.fc_location_timestamp).getFullYear()>1995?r.a.createElement("span",{style:{marginLeft:".5em",color:"rgb(0, 225, 0)"},title:"View this on the Fleet Complete Menu",className:"icon cursor_pointer",onClick:function(t){n({type:"view_fc_by_unit",payload:e.unitcode})}},r.a.createElement("i",{className:"fas fa-edit"})):""),r.a.createElement("td",null,0!==e.cad_latitude?r.a.createElement("span",{title:"View this on the Map",style:{color:"rgb(0,0,225)"},className:"icon cursor_pointer",onClick:function(t){i(e.cad_longitude,e.cad_latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):"",new Date(e.cad_location_timestamp).getFullYear()>1995?r.a.createElement("span",{style:{marginLeft:".5em",color:"rgb(0,0,225)"},title:"View this on the CAD Menu",className:"icon cursor_pointer",onClick:function(t){n({type:"view_cad_by_unit",payload:e.unitcode})}},r.a.createElement("i",{className:"fas fa-edit"})):""),r.a.createElement("td",{className:"has-text-right icon-options"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(t){n({type:"unit_data_toggle_show_errors",payload:e.unitcode})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",onClick:function(t){var a;return g.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.preventDefault(),e.device_history&&0!==e.device_history.length){r.next=8;break}return r.next=4,g.a.awrap(S.GetByUnit(e.unitcode));case 4:a=r.sent,n({type:"unit_device_history",payload:{unitcode:e.unitcode,device_history:a}}),r.next=9;break;case 8:n({type:"unit_device_history",payload:{unitcode:e.unitcode,device_history:[]}});case 9:case"end":return r.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),1995===new Date(e.avl_location_timestamp).getFullYear()&&1995===new Date(e.fc_location_timestamp).getFullYear()&&1995===new Date(e.cad_location_timestamp).getFullYear()?r.a.createElement("span",{style:{marginLeft:".5em"},title:"Delete This Device",className:"icon cursor_pointer has-text-danger",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(H.Delete(e.unitcode));case 3:a.sent.ok?c():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})):"")),r.a.createElement(z,Object.assign({colspan:8,refresh_data:c},e)),r.a.createElement(D,{colspan:8,error_information:e.error_information,show_errors:e.show_errors}),r.a.createElement(j,{colspan:8,title:"History By Device Id",history:e.device_history}))},Y=function(e){var t=r.a.useContext(d),a=t.state,c=t.dispatch,i=function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(H.Get());case 2:return e=t.sent,t.abrupt("return",c({type:"get_unit_data",payload:e}));case 4:case"end":return t.stop()}}))},s=Object(n.useState)(e.unitcode),o=Object(l.a)(s,2),u=o[0],_=o[1],f=Object(n.useState)(function(e){if(0===e.length)return e;var t=a.unit_groups.filter((function(t){return t.label===e}));return t.length>0?t[0].value:""}(e.group_label)),m=Object(l.a)(f,2),p=m[0],v=m[1],h=Object(n.useState)(e.has_avl_device),y=Object(l.a)(h,2),E=y[0],w=y[1],b=Object(n.useState)(e.has_fc_device),x=Object(l.a)(b,2),N=x[0],k=x[1],C=Object(n.useState)(e.should_have_cad_location),D=Object(l.a)(C,2),O=D[0],S=D[1];return e.show_add_unit?r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Unit Code"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{value:u,onChange:function(e){return _(e.target.value)},type:"text"})))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Group:"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select is-small"},r.a.createElement("select",{value:p,onChange:function(e){console.log("event",e,e.target.value),v(e.target.value)}},r.a.createElement("option",{value:""},"No Group"),a.unit_groups.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)}))))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Has AVL Device"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:E,onChange:function(e){return w(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Has Fleet Complete Device"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:N,onChange:function(e){return k(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Should Have CAD Location"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:O,onChange:function(e){return S(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:3}),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(H.Add(u,p,E,N,O));case 3:a.sent.ok?(i(),_(""),w(!1),k(!1),S(!1),v(""),e.cancel()):alert("There was a problem updating this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))},title:"This will save all of the selections above",className:"is-success button is-small"},"Save"),r.a.createElement("button",{title:"Close the Unit Options menu without saving any changes",style:{marginLeft:"1em"},className:"is-warning button is-small",onClick:function(t){e.cancel()}},"Cancel")))),r.a.createElement("td",{colSpan:4}))):null},J=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,c=Object(n.useState)(!1),i=Object(l.a)(c,2),s=i[0],o=i[1],u=Object(n.useState)(t.unit_data_filter||""),_=Object(l.a)(u,2),f=(_[0],_[1]),m=L(H.Get,"get_unit_data",!1),p=m.isLoading,v=m.isError,h=function(e,t,a){return{loading:e,title:"Unit",title_description:"Search for text in the Device Id, Unit, and Asset Tag fields. Search for multiple items by separating with comma.  Hit Enter to Search.",search_type:"search_unit_data",fetchData:t,data_filter:a,special_filter:"unit_data_special_filter",header_filters:[{id:0,label:"Show All",value:""},{id:1,label:"Errors",value:"error"},{id:2,label:"AVL",value:"avl"},{id:3,label:"FC",value:"fc"},{id:4,label:"CAD",value:"cad"}]}}(p,m.fetchData,t.unit_data_filter);return Object(n.useEffect)((function(){}),[p,v,t.filtered_unit_data,t.unit_data_filter,t.unit_data_sort_field,t.unit_data_sort_ascending,t.unit_data_special_filter]),r.a.createElement("section",null,r.a.createElement(U,Object.assign({loading:p},h)),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"#"),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnitCode",onClick:function(e){e.preventDefault(),a({type:"unit_data_sort",payload:"unitcode"})},className:"".concat("unitcode"!==t.unit_data_sort_field?"":t.unit_data_sort_ascending?"sort_ascending":"sort_descending")},"Unit"),r.a.createElement("span",{style:{marginLeft:"1em"},title:"Add A Unit",className:"icon cursor_pointer has-text-danger",onClick:function(e){o(!s)}},r.a.createElement("i",{className:"fas fa-plus-circle"}))),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUsingUnit",onClick:function(e){e.preventDefault(),a({type:"unit_data_sort",payload:"using_unit"})},className:"".concat("using_unit"!==t.unit_data_sort_field?"":t.unit_data_sort_ascending?"sort_ascending":"sort_descending")},"Using Unit")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByGroup",onClick:function(e){e.preventDefault(),a({type:"unit_data_sort",payload:"group_label"})},className:"".concat("group_label"!==t.unit_data_sort_field?"":t.unit_data_sort_ascending?"sort_ascending":"sort_descending")},r.a.createElement("span",{title:"View this on the Map",className:"icon"},r.a.createElement("i",{className:"fas fa-sort"}))),r.a.createElement("div",{style:{display:"inline-block"},className:"control"},r.a.createElement("div",{className:"select is-small"},r.a.createElement("select",{onChange:function(e){var t=e.target.options[e.target.selectedIndex].innerText;"All Groups"===t&&(t=""),f(t),a({type:"search_unit_data",payload:t})}},r.a.createElement("option",{value:""},"All Groups"),t.unit_groups.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)})))))),r.a.createElement("th",null,"AVL"),r.a.createElement("th",null,"FC"),r.a.createElement("th",null,"CAD"),r.a.createElement("th",{className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,r.a.createElement(Y,{unitcode:"",has_avl_device:!1,has_fc_device:!1,should_have_cad_location:!1,group_label:"",show_add_unit:s,cancel:function(){o(!1)}}),t.filtered_unit_data.map((function(e,t){return r.a.createElement(R,Object.assign({key:e.unitcode,index:t},e))})))))},q=a(6),K=function(e){var t=e.state_array,a=e.title,c=e.r,i=e.g,s=e.b,o=r.a.useContext(d).state,u=Object(n.useState)(null),_=Object(l.a)(u,2),f=_[0],m=_[1],p=function(e,t){var a=(t.valueOf()-new Date(e).valueOf())/1e3;return a<60?1:a<120?.9:a<300?.8:a<600?.7:a<1200?.6:a<1800?.5:a<3600?.4:a<14400?.3:a<28800?.2:.1};return Object(n.useEffect)((function(){return o.map&&o[t].length>0&&Object(q.loadModules)(["esri/layers/GraphicsLayer","esri/Graphic"]).then((function(e){var n=Object(l.a)(e,2),r=n[0],d=n[1],u=null===f?new r:f;u.graphics.length>0&&u.removeAll(),u.title=a;var _=new Date,v=!0,h=!1,y=void 0;try{for(var g,E=o[t][Symbol.iterator]();!(v=(g=E.next()).done);v=!0){var w=g.value,b={type:"point",longitude:w.longitude,latitude:w.latitude},x=new d({geometry:b,symbol:{type:"simple-marker",color:[c,i,s,p(w.location_timestamp,_)]}}),N=new d({geometry:b,symbol:{type:"text",color:"black",haloColor:"white",haloSize:"2px",xoffset:9,yoffset:-2,text:w.unitcode.length>0?w.unitcode:w.device_id,horizontalAlignment:"left",font:{size:10}}});u.add(x),u.add(N)}}catch(k){h=!0,y=k}finally{try{v||null==E.return||E.return()}finally{if(h)throw y}}m(u),o.map.add(u)})).catch((function(e){return console.error(e)})),function(){o.map&&o.map.remove(f)}}),[o.map,o[t]]),null},Q=function(){var e=Object(n.useRef)(null),t=r.a.useContext(d).dispatch;return Object(n.useEffect)((function(){Object(q.loadModules)(["esri/Map","esri/views/MapView","esri/widgets/BasemapGallery","esri/widgets/LayerList","esri/widgets/Home","esri/layers/MapImageLayer"],{css:!0}).then((function(a){var n=Object(l.a)(a,6),r=n[0],c=n[1],i=n[2],s=n[3],o=n[4],d=n[5],u=new r({basemap:"streets-navigation-vector"}),_=new c({container:e.current,map:u,center:[-81.8,29.95],zoom:10});new i({view:_,container:document.getElementById("basemap_selector_container"),source:{portal:{url:"http://www.arcgis.com",useVectorBasemaps:!0}}});var f=new d({url:"https://maps.claycountygov.com:6443/arcgis/rest/services/Fire_Response/MapServer",title:"Fire Services"});u.add(f);var m=new d({url:"https://maps.claycountygov.com:6443/arcgis/rest/services/SiteAddresses/MapServer",title:"Site Addresses"});u.add(m),new s({view:_,container:document.getElementById("layerlist_selector_container")});var p=new o({view:_});return _.ui.add(p,{position:"top-left"}),_.when((function(){console.log("view.then running"),t({type:"save_map",payload:u}),t({type:"save_map_view",payload:_})})),function(){_&&(_.container=null)}}))}),[]),r.a.createElement("div",{className:"webmap",ref:e},r.a.createElement(K,{state_array:"filtered_avl_data",title:"AVL Units",r:"255",g:"0",b:"0"}),r.a.createElement(K,{state_array:"filtered_fc_data",title:"Fleet Complete Units",r:"0",g:"255",b:"0"}),r.a.createElement(K,{state_array:"filtered_cad_data",title:"CAD Units",r:"0",g:"0",b:"255"}))},W=function(){function e(){Object(w.a)(this,e),this.label="",this.value=""}return Object(b.a)(e,null,[{key:"GetUnitGroups",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(x("API/Group/GetUnitGroups"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}}]),e}();var X=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,c=L(C.Get,"get_avl_data",!1),i=(c.isLoading,c.isError,c.fetchData),l=L(B.Get,"get_fc_data",!1),s=(l.isLoading,l.isError,l.fetchData),o=L(T.Get,"get_cad_data",!1),u=(o.isLoading,o.isError,o.fetchData),_=L(H.Get,"get_unit_data",!1),f=(_.isLoading,_.isError,_.fetchData);r.a.useEffect((function(){f(),i(),s(),u(),m()}),[]),function(e,t){var a=Object(n.useRef)(null);Object(n.useEffect)((function(){a.current=e}),[e]),Object(n.useEffect)((function(){if(null!==t){var e=setInterval((function(){a.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){console.log("automatically refreshing all"),f(),i(),s(),u(),m()}),6e4);var m=function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(W.GetUnitGroups());case 2:return e=t.sent,t.abrupt("return",a({type:"get_unit_groups_data",payload:e}));case 4:case"end":return t.stop()}}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(E,null),r.a.createElement("div",{className:"columns main-container is-mobile"},r.a.createElement("div",{style:{paddingRight:0},className:"column left-side ".concat("map"!==t.current_view?"is-full-mobile is-full-tablet is-full-desktop is-half-widescreen is-half-fullhd":"hide")},"avl"===t.current_view?r.a.createElement(G,null):null,"unit"===t.current_view?r.a.createElement(J,null):null,"fc"===t.current_view?r.a.createElement(F,null):null,"cad"===t.current_view?r.a.createElement(M,null):null),r.a.createElement("div",{style:{paddingLeft:0},className:"column right-side ".concat("map"!==t.current_view?"is-half-widescreen is-half-fullhd":"")},r.a.createElement(Q,null))))};i.a.render(r.a.createElement((function(e){var t=Object(n.useReducer)(u,o),a=Object(l.a)(t,2),c=a[0],i=a[1];return r.a.createElement(d.Provider,{value:{state:c,dispatch:i}},e.children)}),null,r.a.createElement(X,null)),document.getElementById("root"))},9:function(e,t,a){e.exports=a(15)}},[[9,1,2]]]);
//# sourceMappingURL=main.06825ded.chunk.js.map