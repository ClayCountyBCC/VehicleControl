(this.webpackJsonpvehiclecontrol=this.webpackJsonpvehiclecontrol||[]).push([[0],{10:function(e,t,a){e.exports=a(16)},16:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(9),c=a.n(i),l=a(2),s=a(6),o=a(3),u={map:null,map_view:null,unit_groups:[],current_view:"unit",avl_view:{e:{},data_filter:"",sort_field:"device_id",sort_ascending:!0,special_filter:""},fc_view:{e:{},data_filter:"",sort_field:"device_id",sort_ascending:!0,special_filter:""},cad_view:{e:{},data_filter:"",sort_field:"unitcode",sort_ascending:!0,special_filter:""},unit_view:{e:{},data_filter:"",sort_field:"unitcode",sort_ascending:!0,special_filter:""},avl_data:new Array,fc_data:new Array,cad_data:new Array,unit_data:new Array,filtered_avl_data:new Array,filtered_fc_data:new Array,filtered_cad_data:new Array,filtered_unit_data:new Array},d=r.a.createContext(u);function m(e,t){switch(t.type){case"save_map":return Object(o.a)({},e,{map:t.payload});case"save_map_view":return Object(o.a)({},e,{map_view:t.payload});case"get_unit_groups_data":return Object(o.a)({},e,{unit_groups:t.payload});case"set_current_view":return Object(o.a)({},e,{current_view:t.payload});case"view_by_device":case"view_avl_by_unit":var a=Object(o.a)({},e.avl_view,{data_filter:t.payload,special_filter:""});return Object(o.a)({},e,{current_view:"avl",filtered_avl_data:p(e.avl_data,a),avl_view:a});case"view_fc_by_unit":var n=Object(o.a)({},e.fc_view,{data_filter:t.payload,special_filter:""});return Object(o.a)({},e,{current_view:"fc",filtered_fc_data:v(e.fc_data,n),fc_view:n});case"view_cad_by_unit":var r=Object(o.a)({},e.cad_view,{data_filter:t.payload,special_filter:""});return Object(o.a)({},e,{current_view:"cad",filtered_cad_data:h(e.cad_data,r),cad_view:r});case"get_avl_data":return Object(o.a)({},e,{avl_data:t.payload,filtered_avl_data:p(t.payload,e.avl_view)});case"get_fc_data":return Object(o.a)({},e,{fc_data:t.payload,filtered_fc_data:v(t.payload,e.fc_view)});case"get_cad_data":return Object(o.a)({},e,{cad_data:t.payload,filtered_cad_data:h(t.payload,e.cad_view)});case"get_unit_data":return Object(o.a)({},e,{unit_data:t.payload,filtered_unit_data:E(t.payload,e.unit_view)});case"update_view":var i=e[t.payload.view];return i=Object(o.a)({},e[t.payload.view],{},t.payload.option),Object(o.a)({},e,Object(s.a)({},t.payload.view,i),function(e,t,a){switch(e){case"unit_view":return{filtered_unit_data:E(a.unit_data,t)};case"cad_view":return{filtered_cad_data:h(a.cad_data,t)};case"avl_view":return{filtered_avl_data:p(a.avl_data,t)};case"fc_view":return{filtered_fc_data:v(a.fc_data,t)};default:return{}}}(t.payload.view,i,e));case"update_view_device":var c=t.payload.view.split("_")[0],l=e[t.payload.view].e,u=t.payload.unitcode?t.payload.unitcode:t.payload.device_id;return l[u]||(l[u]={options:!1,errors:!1,history:[],details:!1}),l[u]=Object(o.a)({},l[u],{},t.payload.option),Object(o.a)({},e,Object(s.a)({current_view:c},t.payload.view,Object(o.a)({},e[t.payload.view],{e:l})));default:return console.log("action type not found, returning current state",t.type),e}}function f(e,t){if(0===t.length)return e;switch(t){case"error":return e.filter((function(e){return e.error_information.length>0}));case"asset_tag":return e.filter((function(e){return e.has_asset_tag_error}));case"date":return e.filter((function(e){return e.has_date_error}));case"location":return e.filter((function(e){return e.has_location_error}));case"unit":return e.filter((function(e){return e.has_unit_error}));case"cad":return e.filter((function(e){return e.has_cad_error}));case"avl":return e.filter((function(e){return e.has_avl_error}));case"fc":return e.filter((function(e){return e.has_fc_error}));default:return e}}function _(e,t){return["updated_on","location_timestamp"].indexOf(t.sort_field)>-1?function(e,t,a){return e.sort((function(e,n){return new Date(e[t])>new Date(n[t])?a?1:-1:new Date(n[t])>new Date(e[t])?a?-1:1:0}))}(e,t.sort_field,t.sort_ascending):e.sort((function(e,a){return e[t.sort_field]>a[t.sort_field]?t.sort_ascending?1:-1:a[t.sort_field]>e[t.sort_field]?t.sort_ascending?-1:1:0}))}function p(e,t){return _(f(function(e,t){if(0===t.length)return e;var a=t.toLowerCase().split(",");return e.filter((function(e){var t=!1,n=!0,r=!1,i=void 0;try{for(var c,l=a[Symbol.iterator]();!(n=(c=l.next()).done);n=!0){var s=c.value;if(s=s.trim(),t=e.unitcode.toLowerCase().indexOf(s)>-1||e.device_id.toLowerCase().indexOf(s)>-1)break}}catch(o){r=!0,i=o}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}return t}))}(e,t.data_filter),t.special_filter),t)}function v(e,t){return _(f(function(e,t){if(0===t.length)return e;var a=t.toLowerCase().split(",");return e.filter((function(e){var t=!1,n=!0,r=!1,i=void 0;try{for(var c,l=a[Symbol.iterator]();!(n=(c=l.next()).done);n=!0){var s=c.value;if(s=s.trim(),t=e.unitcode.toLowerCase().indexOf(s)>-1||e.device_id.toLowerCase().indexOf(s)>-1||e.asset_tag.toLowerCase().indexOf(s)>-1)break}}catch(o){r=!0,i=o}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}return t}))}(e,t.data_filter),t.special_filter),t)}function h(e,t){return _(f(function(e,t){if(0===t.length)return e;var a=t.toLowerCase().split(",");return e.filter((function(e){var t=!1,n=!0,r=!1,i=void 0;try{for(var c,l=a[Symbol.iterator]();!(n=(c=l.next()).done);n=!0){var s=c.value;if(s=s.trim(),t=e.unitcode.toLowerCase().indexOf(s)>-1)break}}catch(o){r=!0,i=o}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}return t}))}(e,t.data_filter),t.special_filter),t)}function E(e,t){return _(f(function(e,t){if(0===t.length)return e;var a=t.toLowerCase().split(","),n=t.toLowerCase();return e.filter((function(e){var t=!1,r=!0,i=!1,c=void 0;try{for(var l,s=a[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var o=l.value;if(o=o.trim(),t=e.unitcode.toLowerCase().indexOf(o)>-1||e.group_label.toLowerCase().indexOf(o)>-1||e.using_unit.toLowerCase().indexOf(n)>-1)break}}catch(u){i=!0,c=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw c}}return t}))}(e,t.data_filter),t.special_filter),t)}var w=a(1),g=a.n(w),y=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,n=function(){var e=document.getElementById("nav_basemap_dropdown");null!==e&&e.classList.remove("is-active")};return r.a.createElement("nav",{className:"navbar is-primary",role:"navigation","aria-label":"main navigation"},r.a.createElement("div",{className:"navbar-brand"},r.a.createElement("h1",{className:"navbar-item is-size-3 has-text-weight-bold"},"Vehicle Control")),r.a.createElement("div",{className:"navbar-menu"},r.a.createElement("div",{className:"navbar-start"},r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"unit"})},className:"navbar-item is-tab cursor_pointer ".concat("unit"===t.current_view?"is-active":""," ")},"Units"),r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"avl"})},className:"navbar-item is-tab cursor_pointer ".concat("avl"===t.current_view?"is-active":""," ")},"AVL"),r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"fc"})},className:"navbar-item is-tab cursor_pointer ".concat("fc"===t.current_view?"is-active":""," ")},"Fleet Complete"),r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"cad"})},className:"navbar-item is-tab cursor_pointer ".concat("cad"===t.current_view?"is-active":""," ")},"CAD"),r.a.createElement("p",{onClick:function(e){a({type:"set_current_view",payload:"map"})},className:"navbar-item is-tab cursor_pointer ".concat("map"===t.current_view?"is-active":""," ")},"Map")),r.a.createElement("div",{style:{paddingRight:"4em"},className:"navbar-end"},r.a.createElement("div",{id:"nav_basemap_dropdown",className:"navbar-item has-dropdown"},r.a.createElement("a",{className:"navbar-link",onClick:function(e){var t=document.getElementById("nav_basemap_dropdown");if(null!==t){var a=t.classList.contains("is-active");document.querySelectorAll(".esri-basemap-gallery__item").forEach((function(e){a?e.removeEventListener("click",n):e.addEventListener("click",n)})),t.classList.toggle("is-active")}}},"Select Base Map"),r.a.createElement("div",{id:"basemap-navbar-dropdown",className:"navbar-dropdown"},r.a.createElement("div",{className:"navbar-item"},r.a.createElement("div",{id:"basemap_selector_container"})))),r.a.createElement("div",{id:"nav_layerlist_dropdown",className:"navbar-item has-dropdown"},r.a.createElement("a",{className:"navbar-link",onClick:function(e){var t=document.getElementById("nav_layerlist_dropdown");null!==t&&t.classList.toggle("is-active")}},"View Layers"),r.a.createElement("div",{className:"navbar-dropdown"},r.a.createElement("div",{className:"navbar-item"},r.a.createElement("div",{id:"layerlist_selector_container"})))),r.a.createElement("p",{className:"navbar-item"}))))},b=a(4),x=a(5);function N(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"}));case 2:if((t=a.sent).ok){a.next=5;break}throw new Error(t.statusText);case 5:return a.next=7,g.a.awrap(t.json());case 7:return a.abrupt("return",a.sent);case 8:case"end":return a.stop()}}))}function k(e,t){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.a.awrap(fetch(e,{method:"POST",body:null!==t?JSON.stringify(t):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}));case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}))}function D(e){return e instanceof Date?e.toLocaleString("en-us"):new Date(e).toLocaleString("en-US")}var C=function(){function e(){Object(b.a)(this,e),this.device_id="",this.device_type="",this.unitcode="",this.direction=0,this.location_timestamp=new Date,this.satellite_count=0,this.velocity=0,this.latitude=0,this.longitude=0,this.updated_on=new Date,this.error_information=[],this.show_unit_options=!1,this.show_errors=!1,this.has_date_error=!1,this.has_location_error=!1,this.has_unit_error=!1,this.device_history=[]}return Object(x.a)(e,null,[{key:"Get",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(N("API/AVL/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(k("API/AVL/Delete?device_id="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"Update",value:function(e,t,a){var n;return g.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,g.a.awrap(k("API/AVL/Update?device_id=".concat(e,"&device_type=").concat(t,"&unitcode=").concat(a),{}));case 2:return n=r.sent,r.abrupt("return",n);case 4:case"end":return r.stop()}}))}}]),e}(),O=function(e){return e.show_errors?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:e.colspan-1},r.a.createElement("ul",null,e.error_information.map((function(e,t){return r.a.createElement("li",{key:t},e)}))))):null},S=function(e){var t=Object(n.useState)(""),a=Object(l.a)(t,2),i=a[0],c=a[1];return e.show_unit_options?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Current Unit:"),r.a.createElement("td",null,0===e.unitcode.length?"None":e.unitcode),r.a.createElement("td",{className:"has-text-right"},"Change To:"),r.a.createElement("td",{colSpan:2},r.a.createElement("div",{className:"field has-addons"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input is-small",type:"text",onChange:function(e){return c(e.target.value)},value:i,placeholder:"New Unit"})),r.a.createElement("div",{className:"control"},r.a.createElement("button",{type:"button",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:t.preventDefault(),console.log("props asset_tag",e.asset_tag),e.asset_tag?e.update_data(e.asset_tag,i.trim()):e.update_data(e.device_id,e.device_type,i.trim());case 3:case"end":return a.stop()}}))},className:"button is-success is-small"},"Save"))))):null},j=function(){function e(){Object(b.a)(this,e),this.id=-1,this.unitcode="",this.field="",this.changed_from="",this.changed_to="",this.changed_on=new Date,this.changed_by="",this.error_message=""}return Object(x.a)(e,null,[{key:"GetByUnit",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(N("API/History/Unit?unit="+e));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"GetByDeviceId",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(N("API/History/DeviceId?deviceId="+e));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}}]),e}(),A=function(e){return e.history&&0!==e.history.length?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:e.colspan-1},r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"has-text-centered",colSpan:e.colspan},e.title)),r.a.createElement("tr",null,r.a.createElement("th",null,"Unitcode"),r.a.createElement("th",null,"Field"),r.a.createElement("th",null,"Changed From"),r.a.createElement("th",null,"Changed To"),r.a.createElement("th",null,"Changed On"),r.a.createElement("th",null,"Changed By"))),r.a.createElement("tbody",null,e.history.map((function(e){return e.error_message.length>0?r.a.createElement("tr",{key:e.id},r.a.createElement("td",{colSpan:6},e.error_message)):r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,e.unitcode),r.a.createElement("td",null,e.field),r.a.createElement("td",null,e.changed_from),r.a.createElement("td",null,e.changed_to),r.a.createElement("td",null,D(e.changed_on)),r.a.createElement("td",null,e.changed_by))})))))):null},L=function(e){if(!e.show_details)return null;var t=["device_id","device_type","updated_on","location_timestamp","longitude","latitude","direction","satellite_count","unitcode","velocity","asset_tag","vin","make","model","vehicle_year","inci_id","status","avstatus"],a=["location_timestamp","updated_on"],n=Object.keys(e);return r.a.createElement(r.a.Fragment,null,n.map((function(n){if(t.indexOf(n)>-1)return r.a.createElement("tr",{key:n},r.a.createElement("td",null),r.a.createElement("td",{colSpan:2},n),r.a.createElement("td",{colSpan:e.colspan-3},a.indexOf(n)>-1?D(e[n]):e[n]?e[n].toString():""))})))},U=function(e){var t=r.a.useContext(d),a=t.state,n=t.dispatch,i=a.avl_view,c=function(t){n({type:"update_view_device",payload:{view:"avl_view",device_id:e.device_id,option:t}})},l=function(t){var a=i.e[e.device_id];return!!a&&a[t]},s=function(){return i.e[e.device_id]&&i.e[e.device_id].history?i.e[e.device_id].history:[]};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",{id:"avl"+e.device_id},r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,r.a.createElement("span",{title:"View device details",className:"cursor_pointer has-text-link",onClick:function(e){c({details:!l("details")})}},e.device_id),0!==e.latitude?r.a.createElement("span",{title:"View this on the Map",style:{color:"rgb(225,0,0)"},className:"icon cursor_pointer",onClick:function(t){!function(e,t){if(a.map_view){var n={type:"point",longitude:e,latitude:t};a.map_view.center=n,a.map_view.zoom<18&&(a.map_view.zoom=18)}}(e.longitude,e.latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):""),r.a.createElement("td",null,r.a.createElement("span",{className:"icon"},r.a.createElement("i",{className:"fas ".concat("Phone Number"===e.device_type?"fa-phone":"fa-sim-card")}))),r.a.createElement("td",null,r.a.createElement("span",{title:"Change this Device's unit",className:"cursor_pointer has-text-link",onClick:function(e){c({options:!l("options")})}},0===e.unitcode.length?"Add":e.unitcode)),r.a.createElement("td",null,D(e.updated_on)),r.a.createElement("td",null,D(e.location_timestamp)),r.a.createElement("td",{className:"has-text-right icon-options"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(e){c({errors:!l("errors")})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",onClick:function(t){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.preventDefault(),0!==(a=s()).length){n.next=8;break}return n.next=5,g.a.awrap(j.GetByUnit(e.unitcode));case 5:a=n.sent,n.next=9;break;case 8:a=[];case 9:c({history:a});case 10:case"end":return n.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),r.a.createElement("span",{title:"Delete This Device",className:"icon cursor_pointer has-text-danger",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(C.Delete(e.device_id));case 3:a.sent.ok?e.fetchData():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})))),r.a.createElement(L,Object.assign({colspan:7,show_details:l("details")},e)),r.a.createElement(S,Object.assign({colspan:7,new_unitcode:"",update_data:function(t,a,n){return g.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,g.a.awrap(C.Update(t,a,n));case 2:r.sent.ok?e.fetchData():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 4:case"end":return r.stop()}}))},show_unit_options:l("options")},e)),r.a.createElement(O,{colspan:7,error_information:e.error_information,show_errors:l("errors")}),r.a.createElement(A,{colspan:7,title:"History By Device Id",history:s()}))},I=function(e,t,a){var i=r.a.useContext(d).dispatch,c=Object(n.useState)(!1),s=Object(l.a)(c,2),o=s[0],u=s[1],m=Object(n.useState)(!1),f=Object(l.a)(m,2),_=f[0],p=f[1],v=function(){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return p(!1),u(!0),n.prev=2,n.next=5,g.a.awrap(e());case 5:a=n.sent,i({type:t,payload:a}),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(2),p(!0),console.log("error in useFetchData",n.t0);case 13:u(!1);case 14:case"end":return n.stop()}}),null,null,[[2,9]])};return Object(n.useEffect)((function(){a&&v()}),[]),{isLoading:o,isError:_,fetchData:v}},G=function(e){var t=e.title,a=e.title_description,i=e.loading,c=e.fetchData,s=e.view_name,o=e.header_filters,u=r.a.useContext(d),m=u.state,f=u.dispatch,_=Object(n.useState)(m[s].data_filter||""),p=Object(l.a)(_,2),v=p[0],h=p[1],E=function(e){f({type:"update_view",payload:{view:s,option:e}})};return Object(n.useEffect)((function(){}),[i,m[s]]),r.a.createElement("div",{style:{padding:"1em",marginBottom:0},className:"level"},r.a.createElement("div",{className:"level-left"},r.a.createElement("div",{className:"level-item is-size-3 has-text-weight-bold"},t),r.a.createElement("div",{className:"level-item"},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control ".concat(i?"is-loading":"")},r.a.createElement("input",{className:"input is-small",title:a,type:"text",placeholder:"Search",onChange:function(e){return h(e.target.value)},value:v,onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),E({data_filter:v}))}})))),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(e){e.preventDefault(),c()},title:"Refresh data",type:"button",className:"button is-success is-small ".concat(i?"is-loading":"")},r.a.createElement("span",{className:"icon is-small"},r.a.createElement("i",{className:"fas fa-sync-alt"}))),r.a.createElement("button",{style:{marginLeft:".5em"},onClick:function(e){e.preventDefault(),e.stopPropagation(),h(""),E({data_filter:""})},title:"Reset the Search",type:"button",className:"button is-warning is-small"},r.a.createElement("span",{className:"icon is-small"},r.a.createElement("i",{className:"fas fa-undo-alt"}))))),r.a.createElement("div",{className:"level-right"},r.a.createElement("p",{className:"level-item has-text-weight-bold"},"Filters"),r.a.createElement("div",{className:"level-item tabs"},r.a.createElement("ul",null,o.map((function(e){return r.a.createElement("li",{className:"".concat(m[s].special_filter===e.value?"is-active":""),key:e.id},r.a.createElement("a",{onClick:function(t){E({special_filter:e.value})}},e.label))}))))))},B=G,V=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,i=I(C.Get,"get_avl_data",!1),c=i.isLoading,l=i.isError,s=i.fetchData,o=function(e,t){return{loading:e,title:"AVL",title_description:"Search for text in the Device Id and Unit fields. Search for multiple items by separating with comma. Hit Enter to Search.",fetchData:t,view_name:"avl_view",header_filters:[{id:0,label:"Show All",value:""},{id:1,label:"All Errors",value:"error"},{id:2,label:"Unit",value:"unit"},{id:3,label:"Date",value:"date"},{id:4,label:"Location",value:"location"}]}}(c,s),u=t.avl_view,m=function(e){a({type:"update_view",payload:{view:"avl_view",option:{sort_field:e,sort_ascending:!u.sort_ascending}}})};return Object(n.useEffect)((function(){}),[c,l,t.filtered_avl_data,u]),r.a.createElement("section",null,r.a.createElement(B,Object.assign({loading:c},o)),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"#"),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDeviceId",onClick:function(e){e.preventDefault(),m("device_id")},className:"".concat("device_id"!==u.sort_field?"":u.sort_ascending?"sort_ascending":"sort_descending")},"Device Id")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDeviceType",onClick:function(e){e.preventDefault(),m("device_type")},className:"".concat("device_type"!==u.sort_field?"":u.sort_ascending?"sort_ascending":"sort_descending")},"Type")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnit",onClick:function(e){e.preventDefault(),m("unitcode")},className:"".concat("unitcode"!==u.sort_field?"":u.sort_ascending?"sort_ascending":"sort_descending")},"Unit")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDateSavedOn",onClick:function(e){e.preventDefault(),m("updated_on")},className:"".concat("updated_on"!==u.sort_field?"":u.sort_ascending?"sort_ascending":"sort_descending")},"Data Saved On")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByLocationDate",onClick:function(e){e.preventDefault(),m("location_timestamp")},className:"".concat("location_timestamp"!==u.sort_field?"":u.sort_ascending?"sort_ascending":"sort_descending")},"Location On")),r.a.createElement("th",{className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,t.filtered_avl_data.map((function(e,t){return r.a.createElement(U,Object.assign({key:e.device_id,index:t},e,{fetchData:s}))})))))},F=function(){function e(){Object(b.a)(this,e),this.device_id="",this.asset_tag="",this.unitcode="",this.vin="",this.make="",this.model="",this.vehicle_year="",this.direction=0,this.location_timestamp=new Date,this.updated_on=new Date,this.velocity=0,this.latitude=0,this.longitude=0,this.error_information=[],this.show_unit_options=!1,this.show_errors=!1,this.has_date_error=!1,this.has_location_error=!1,this.has_asset_tag_error=!1,this.has_unit_error=!1,this.device_history=[]}return Object(x.a)(e,null,[{key:"Get",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(N("API/FC/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(k("API/FC/Delete?device_id="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"Update",value:function(e,t){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.a.awrap(k("API/FC/Update?asset_tag=".concat(e,"&unitcode=").concat(t),{}));case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}))}}]),e}(),T=function(e){var t=r.a.useContext(d),a=t.state,n=t.dispatch,i=a.fc_view,c=function(t){n({type:"update_view_device",payload:{view:"fc_view",device_id:e.device_id,option:t}})},l=function(t){var a=i.e[e.device_id];return!!a&&a[t]},s=function(){return i.e[e.device_id]&&i.e[e.device_id].history?i.e[e.device_id].history:[]};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,r.a.createElement("span",{title:"View device details",className:"cursor_pointer has-text-link",onClick:function(e){c({details:!l("details")})}},e.device_id.replace(/^0+/,"")),0!==e.latitude?r.a.createElement("span",{title:"View this on the Map",className:"icon cursor_pointer",style:{color:"rgb(0,225,0)"},onClick:function(t){!function(e,t){if(a.map_view){var n={type:"point",longitude:e,latitude:t};a.map_view.center=n,a.map_view.zoom<18&&(a.map_view.zoom=18)}}(e.longitude,e.latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):""),r.a.createElement("td",null,e.asset_tag===e.device_id?"":e.asset_tag),r.a.createElement("td",null,r.a.createElement("span",{title:"Change this Device's unit",className:"cursor_pointer has-text-link",onClick:function(e){c({options:!l("options")})}},0===e.unitcode.length?"Add":e.unitcode)),r.a.createElement("td",null,D(e.updated_on)),r.a.createElement("td",null,D(e.location_timestamp)),r.a.createElement("td",{className:"has-text-right icon-options"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(e){c({errors:!l("errors")})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",onClick:function(t){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.preventDefault(),0!==(a=s()).length){n.next=8;break}return n.next=5,g.a.awrap(j.GetByDeviceId(e.asset_tag));case 5:a=n.sent,n.next=9;break;case 8:a=[];case 9:c({history:a});case 10:case"end":return n.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),r.a.createElement("span",{title:"Delete This Device",className:"icon cursor_pointer has-text-danger",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(F.Delete(e.device_id));case 3:a.sent.ok?e.fetchData():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})))),r.a.createElement(L,Object.assign({colspan:7,show_details:l("details")},e)),r.a.createElement(S,Object.assign({colspan:7,new_unitcode:"",update_data:function(t,a){return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.a.awrap(F.Update(t,a));case 2:n.sent.ok?e.fetchData():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 4:case"end":return n.stop()}}))},show_unit_options:l("options")},e)),r.a.createElement(O,{colspan:7,error_information:e.error_information,show_errors:l("errors")}),r.a.createElement(A,{colspan:7,title:"History By Device Id",history:s()}))},P=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,i=I(F.Get,"get_fc_data",!1),c=i.isLoading,l=i.isError,s=function(e,t){return{loading:e,title:"FC",title_description:"Search for text in the Device Id, Unit, and Asset Tag fields. Search for multiple items by separating with comma. Hit Enter to Search.",fetchData:t,view_name:"fc_view",header_filters:[{id:0,label:"Show All",value:""},{id:1,label:"Errors",value:"error"},{id:2,label:"Asset Tag",value:"asset_tag"},{id:3,label:"Unit",value:"unit"},{id:4,label:"Date",value:"date"},{id:5,label:"Location",value:"location"}]}}(c,i.fetchData),o=t.fc_view,u=function(e){a({type:"update_view",payload:{view:"fc_view",option:{sort_field:e,sort_ascending:!o.sort_ascending}}})};return Object(n.useEffect)((function(){}),[c,l,t.filtered_fc_data,o]),r.a.createElement("section",null,r.a.createElement(G,Object.assign({loading:c},s)),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{width:"5%"}},"#"),r.a.createElement("th",{style:{width:"15%"}},r.a.createElement("a",{href:"#SortByDeviceId",onClick:function(e){e.preventDefault(),u("device_id")},className:"".concat("device_id"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Device Id")),r.a.createElement("th",{style:{width:"10%"}},r.a.createElement("a",{href:"#SortByAssetTag",onClick:function(e){e.preventDefault(),u("asset_tag")},className:"".concat("asset_tag"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Asset Tag")),r.a.createElement("th",{style:{width:"8%"}},r.a.createElement("a",{href:"#SortByUnit",onClick:function(e){e.preventDefault(),u("unitcode")},className:"".concat("unitcode"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Unit")),r.a.createElement("th",{style:{width:"24%"}},r.a.createElement("a",{href:"#SortByDateSavedOn",onClick:function(e){e.preventDefault(),u("updated_on")},className:"".concat("updated_on"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Data Saved On")),r.a.createElement("th",{style:{width:"24%"}},r.a.createElement("a",{href:"#SortByLocationDate",onClick:function(e){e.preventDefault(),u("location_timestamp")},className:"".concat("location_timestamp"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Location On")),r.a.createElement("th",{style:{width:"14%"},className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,t.filtered_fc_data.map((function(e,t){return r.a.createElement(T,Object.assign({key:e.device_id,index:t},e))})))))},M=function(){function e(){Object(b.a)(this,e),this.unitcode="",this.location_timestamp=new Date,this.inci_id="",this.status="",this.avstatus="",this.latitude=0,this.longitude=0,this.speed=0,this.heading=0,this.updated_on=new Date,this.error_information=[],this.show_unit_options=!1,this.show_errors=!1,this.has_date_error=!1,this.has_location_error=!1,this.has_unit_error=!1,this.device_history=[]}return Object(x.a)(e,null,[{key:"Get",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(N("API/CAD/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(k("API/CAD/Delete?unitcode="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}}]),e}(),H=function(e){var t=r.a.useContext(d),a=t.state,n=t.dispatch,i=a.cad_view,c=function(t){n({type:"update_view_device",payload:{view:"cad_view",unitcode:e.unitcode,option:t}})},l=function(t){var a=i.e[e.unitcode];return!!a&&a[t]},s=function(){return i.e[e.unitcode]&&i.e[e.unitcode].history?i.e[e.unitcode].history:[]};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",{id:"cad"+e.unitcode},r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,r.a.createElement("span",{title:"View device details",className:"cursor_pointer has-text-link",onClick:function(e){c({details:!l("details")})}},e.unitcode),0!==e.latitude?r.a.createElement("span",{title:"View this on the Map",style:{color:"rgb(0,0,225)"},className:"icon cursor_pointer",onClick:function(t){!function(e,t){if(a.map_view){var n={type:"point",longitude:e,latitude:t};a.map_view.center=n,a.map_view.zoom<18&&(a.map_view.zoom=18)}}(e.longitude,e.latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):""),r.a.createElement("td",null,e.inci_id.trim().length>0?"On A Call":""),r.a.createElement("td",null,e.status),r.a.createElement("td",null,e.avstatus),r.a.createElement("td",null,D(e.updated_on)),r.a.createElement("td",null,D(e.location_timestamp)),r.a.createElement("td",{className:"has-text-right icon-options"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(e){c({errors:!l("errors")})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",onClick:function(t){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.preventDefault(),0!==(a=s()).length){n.next=8;break}return n.next=5,g.a.awrap(j.GetByDeviceId(e.unitcode));case 5:a=n.sent,n.next=9;break;case 8:a=[];case 9:c({history:a});case 10:case"end":return n.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),r.a.createElement("span",{title:"Delete This Device",className:"icon cursor_pointer has-text-danger",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(M.Delete(e.unitcode));case 3:a.sent.ok?e.fetchData():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})))),r.a.createElement(L,Object.assign({colspan:8,show_details:l("details")},e)),r.a.createElement(O,{colspan:8,error_information:e.error_information,show_errors:l("errors")}),r.a.createElement(A,{colspan:8,title:"History By Device Id",history:s()}))},z=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,i=I(M.Get,"get_cad_data",!1),c=i.isLoading,l=i.isError,s=function(e,t){return{loading:e,title:"CAD",title_description:"Search for text in the UnitCode field. Search for multiple items by separating with comma. Hit Enter to Search.",fetchData:t,view_name:"cad_view",header_filters:[{id:0,label:"Show All",value:""},{id:1,label:"Errors",value:"error"},{id:3,label:"Date",value:"date"},{id:4,label:"Location",value:"location"}]}}(c,i.fetchData),o=t.cad_view,u=function(e){a({type:"update_view",payload:{view:"cad_view",option:{sort_field:e,sort_ascending:!o.sort_ascending}}})};return Object(n.useEffect)((function(){}),[c,l,t.filtered_cad_data,o]),r.a.createElement("section",null,r.a.createElement(G,Object.assign({loading:c},s)),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"#"),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnitCode",onClick:function(e){e.preventDefault(),u("unitcode")},className:"".concat("unitcode"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Unit Code")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByCallStatus",onClick:function(e){e.preventDefault(),u("inci_id")},className:"".concat("inci_id"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Call Status")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnitStatus",onClick:function(e){e.preventDefault(),u("status")},className:"".concat("status"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Status")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnitAVStatus",onClick:function(e){e.preventDefault(),u("avstatus")},className:"".concat("avstatus"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"AV Status")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDateSavedOn",onClick:function(e){e.preventDefault(),u("updated_on")},className:"".concat("updated_on"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Data Saved On")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByLocationDate",onClick:function(e){e.preventDefault(),u("location_timestamp")},className:"".concat("location_timestamp"!==o.sort_field?"":o.sort_ascending?"sort_ascending":"sort_descending")},"Location On")),r.a.createElement("th",{className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,t.filtered_cad_data.map((function(e,t){return r.a.createElement(H,Object.assign({key:e.unitcode,index:t},e))})))))},R=function(){function e(){Object(b.a)(this,e),this.unitcode="",this.using_unit="",this.group_label="",this.show_in_minicad=!1,this.avl_device_id="",this.avl_longitude=0,this.avl_latitude=0,this.avl_location_timestamp=new Date,this.has_avl_device=!1,this.has_avl_error=!1,this.fc_device_id="",this.fc_longitude=0,this.fc_latitude=0,this.fc_location_timestamp=new Date,this.has_fc_device=!1,this.has_fc_error=!1,this.cad_longitude=0,this.cad_latitude=0,this.cad_location_timestamp=new Date,this.should_have_cad_location=!1,this.has_cad_error=!1,this.error_information=[],this.show_errors=!1,this.show_unit_options=!1,this.device_history=[]}return Object(x.a)(e,null,[{key:"Get",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(N("API/Unit/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g.a.awrap(k("API/Unit/Delete?unitcode="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"Update",value:function(e,t,a,n,r){var i;return g.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,g.a.awrap(k("API/Unit/Update?unitcode=".concat(e,"&group=").concat(t,"&has_avl=").concat(a,"&has_fc=").concat(n,"&should_have_cad=").concat(r),{}));case 2:return i=c.sent,c.abrupt("return",i);case 4:case"end":return c.stop()}}))}},{key:"Add",value:function(e,t,a,n,r){var i;return g.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,g.a.awrap(k("API/Unit/Add?unitcode=".concat(e,"&group=").concat(t,"&has_avl=").concat(a,"&has_fc=").concat(n,"&should_have_cad=").concat(r),{}));case 2:return i=c.sent,c.abrupt("return",i);case 4:case"end":return c.stop()}}))}}]),e}(),Y=function(e){var t=r.a.useContext(d),a=t.state,i=t.dispatch,c=Object(n.useState)(e.unitcode),s=Object(l.a)(c,2),o=(s[0],s[1],Object(n.useState)(function(e){if(0===e.length)return e;var t=a.unit_groups.filter((function(t){return t.label===e}));return t.length>0?t[0].value:""}(e.group_label))),u=Object(l.a)(o,2),m=u[0],f=u[1],_=Object(n.useState)(e.has_avl_device),p=Object(l.a)(_,2),v=p[0],h=p[1],E=Object(n.useState)(e.has_fc_device),w=Object(l.a)(E,2),y=w[0],b=w[1],x=Object(n.useState)(e.should_have_cad_location),N=Object(l.a)(x,2),k=N[0],D=N[1];return a.unit_view.e[e.unitcode]&&a.unit_view.e[e.unitcode].options?r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Group:"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select is-small"},r.a.createElement("select",{value:m,onChange:function(e){f(e.target.value)}},r.a.createElement("option",{value:""},"No Group"),a.unit_groups.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)}))))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Has AVL Device"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:v,onChange:function(e){return h(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Has Fleet Complete Device"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:y,onChange:function(e){return b(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Should Have CAD Location"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:k,onChange:function(e){return D(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:3}),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(R.Update(e.unitcode,m,v,y,k));case 3:a.sent.ok?e.refresh_data():alert("There was a problem updating this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))},title:"This will save all of the selections above",className:"is-success button is-small"},"Save"),r.a.createElement("button",{title:"Close the Unit Options menu without saving any changes",style:{marginLeft:"1em"},className:"is-warning button is-small",onClick:function(t){i({type:"unit_data_toggle_show_unit_options",payload:e.unitcode})}},"Cancel")))),r.a.createElement("td",{colSpan:4}))):null},J=function(e){var t=r.a.useContext(d),a=t.state,n=t.dispatch,i=a.unit_view,c=function(e,t){if(a.map_view){var n={type:"point",longitude:e,latitude:t};a.map_view.center=n,a.map_view.zoom<18&&(a.map_view.zoom=18)}},l=function(t){n({type:"update_view_device",payload:{view:"unit_view",unitcode:e.unitcode,option:t}})},s=function(e,t){n({type:"update_view",payload:{view:e,option:t}})},o=function(e,t,a,r){n({type:"update_view_device",payload:{view:e,unitcode:t,device_id:a,option:r}})},u=function(t){var a=i.e[e.unitcode];return!!a&&a[t]},m=function(){var t=i.e[e.unitcode];return t&&t.history?t.history:[]};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,r.a.createElement("span",{title:"Change this Unit's Information",className:"cursor_pointer has-text-link",onClick:function(e){l({options:!u("options")})}},e.unitcode)),r.a.createElement("td",null,e.using_unit),r.a.createElement("td",null,e.group_label),r.a.createElement("td",null,0!==e.avl_latitude?r.a.createElement("span",{title:"View this on the Map",style:{color:"rgb(225,0,0)"},className:"icon cursor_pointer",onClick:function(t){c(e.avl_longitude,e.avl_latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):"",new Date(e.avl_location_timestamp).getFullYear()>1995?r.a.createElement("span",{style:{marginLeft:".5em",color:"rgb(225, 0, 0)"},title:"View this on the AVL Menu",className:"icon cursor_pointer",onClick:function(t){s("avl_view",{data_filter:e.avl_device_id,special_filter:""}),o("avl_view",e.avl_device_id,void 0,{details:!0})}},r.a.createElement("i",{className:"fas fa-edit"})):""),r.a.createElement("td",null,0!==e.fc_latitude?r.a.createElement("span",{title:"View this on the Map",className:"icon cursor_pointer",style:{color:"rgb(0,225,0)"},onClick:function(t){c(e.fc_longitude,e.fc_latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):"",new Date(e.fc_location_timestamp).getFullYear()>1995?r.a.createElement("span",{style:{marginLeft:".5em",color:"rgb(0, 225, 0)"},title:"View this on the Fleet Complete Menu",className:"icon cursor_pointer",onClick:function(t){s("fc_view",{data_filter:e.fc_device_id,special_filter:""}),o("fc_view",e.fc_device_id,void 0,{details:!0})}},r.a.createElement("i",{className:"fas fa-edit"})):""),r.a.createElement("td",null,0!==e.cad_latitude?r.a.createElement("span",{title:"View this on the Map",style:{color:"rgb(0,0,225)"},className:"icon cursor_pointer",onClick:function(t){c(e.cad_longitude,e.cad_latitude)}},r.a.createElement("i",{className:"fas fa-eye"})):"",new Date(e.cad_location_timestamp).getFullYear()>1995?r.a.createElement("span",{style:{marginLeft:".5em",color:"rgb(0,0,225)"},title:"View this on the CAD Menu",className:"icon cursor_pointer",onClick:function(t){s("cad_view",{data_filter:e.unitcode,special_filter:""}),o("cad_view",void 0,e.unitcode,{details:!0})}},r.a.createElement("i",{className:"fas fa-edit"})):""),r.a.createElement("td",{className:"has-text-right icon-options"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(e){l({errors:!u("errors")})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",onClick:function(t){var a;return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.preventDefault(),0!==(a=m()).length){n.next=8;break}return n.next=5,g.a.awrap(j.GetByUnit(e.unitcode));case 5:a=n.sent,n.next=9;break;case 8:a=[];case 9:l({history:a});case 10:case"end":return n.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),1995===new Date(e.avl_location_timestamp).getFullYear()&&1995===new Date(e.fc_location_timestamp).getFullYear()&&1995===new Date(e.cad_location_timestamp).getFullYear()?r.a.createElement("span",{style:{marginLeft:".5em"},title:"Delete This Device",className:"icon cursor_pointer has-text-danger",onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(R.Delete(e.unitcode));case 3:a.sent.ok?e.fetchData():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})):"")),r.a.createElement(Y,Object.assign({colspan:8,refresh_data:e.fetchData,show_unit_options:u("options")},e)),r.a.createElement(O,{colspan:8,error_information:e.error_information,show_errors:u("errors")}),r.a.createElement(A,{colspan:8,title:"History By Device Id",history:m()}))},q=function(e){var t=r.a.useContext(d),a=t.state,i=t.dispatch,c=function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(R.Get());case 2:return e=t.sent,t.abrupt("return",i({type:"get_unit_data",payload:e}));case 4:case"end":return t.stop()}}))},s=Object(n.useState)(e.unitcode),o=Object(l.a)(s,2),u=o[0],m=o[1],f=Object(n.useState)(function(e){if(0===e.length)return e;var t=a.unit_groups.filter((function(t){return t.label===e}));return t.length>0?t[0].value:""}(e.group_label)),_=Object(l.a)(f,2),p=_[0],v=_[1],h=Object(n.useState)(e.has_avl_device),E=Object(l.a)(h,2),w=E[0],y=E[1],b=Object(n.useState)(e.has_fc_device),x=Object(l.a)(b,2),N=x[0],k=x[1],D=Object(n.useState)(e.should_have_cad_location),C=Object(l.a)(D,2),O=C[0],S=C[1];return e.show_add_unit?r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Unit Code"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{value:u,onChange:function(e){return m(e.target.value)},type:"text"})))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Group:"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select is-small"},r.a.createElement("select",{value:p,onChange:function(e){console.log("event",e,e.target.value),v(e.target.value)}},r.a.createElement("option",{value:""},"No Group"),a.unit_groups.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)}))))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Has AVL Device"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:w,onChange:function(e){return y(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Has Fleet Complete Device"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:N,onChange:function(e){return k(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:2,className:"has-text-right"},"Should Have CAD Location"),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{checked:O,onChange:function(e){return S(e.target.checked)},type:"checkbox"}))))),r.a.createElement("td",{colSpan:4})),r.a.createElement("tr",null,r.a.createElement("td",{colSpan:3}),r.a.createElement("td",null,r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{onClick:function(t){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,g.a.awrap(R.Add(u,p,w,N,O));case 3:a.sent.ok?(c(),m(""),y(!1),k(!1),S(!1),v(""),e.cancel()):alert("There was a problem updating this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))},title:"This will save all of the selections above",className:"is-success button is-small"},"Save"),r.a.createElement("button",{title:"Close the Unit Options menu without saving any changes",style:{marginLeft:"1em"},className:"is-warning button is-small",onClick:function(t){e.cancel()}},"Cancel")))),r.a.createElement("td",{colSpan:4}))):null},K=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,i=Object(n.useState)(!1),c=Object(l.a)(i,2),s=c[0],o=c[1],u=t.unit_view,m=Object(n.useState)(u.data_filter||""),f=Object(l.a)(m,2),_=(f[0],f[1]),p=I(R.Get,"get_unit_data",!1),v=p.isLoading,h=p.isError,E=p.fetchData,w=function(e,t){return{loading:e,title:"Unit",title_description:"Search for text in the Device Id, Unit, and Asset Tag fields. Search for multiple items by separating with comma.  Hit Enter to Search.",fetchData:t,view_name:"unit_view",header_filters:[{id:0,label:"Show All",value:""},{id:1,label:"Errors",value:"error"},{id:2,label:"AVL",value:"avl"},{id:3,label:"FC",value:"fc"},{id:4,label:"CAD",value:"cad"}]}}(v,E),g=function(e){a({type:"update_view",payload:{view:"unit_view",option:{sort_field:e,sort_ascending:!t.unit_view.sort_ascending}}})};return Object(n.useEffect)((function(){}),[v,h,t.filtered_unit_data,t.unit_view]),r.a.createElement("section",null,r.a.createElement(G,Object.assign({loading:v},w)),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"#"),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnitCode",onClick:function(e){e.preventDefault(),g("unitcode")},className:"".concat("unitcode"!==u.sort_field?"":u.sort_ascending?"sort_ascending":"sort_descending")},"Unit"),r.a.createElement("span",{style:{marginLeft:"1em"},title:"Add A Unit",className:"icon cursor_pointer has-text-danger",onClick:function(e){o(!s)}},r.a.createElement("i",{className:"fas fa-plus-circle"}))),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUsingUnit",onClick:function(e){e.preventDefault(),g("using_unit")},className:"".concat("using_unit"!==u.sort_field?"":u.sort_ascending?"sort_ascending":"sort_descending")},"Using Unit")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByGroup",onClick:function(e){e.preventDefault(),g("group_label")},className:"".concat("group_label"!==u.sort_field?"":u.sort_ascending?"sort_ascending":"sort_descending")},r.a.createElement("span",{title:"View this on the Map",className:"icon"},r.a.createElement("i",{className:"fas fa-sort"}))),r.a.createElement("div",{style:{display:"inline-block"},className:"control"},r.a.createElement("div",{className:"select is-small"},r.a.createElement("select",{onChange:function(e){var t=e.target.options[e.target.selectedIndex].innerText;"All Groups"===t&&(t=""),_(t),a({type:"update_view",payload:{view:"unit_view",option:{data_filter:t}}})}},r.a.createElement("option",{value:""},"All Groups"),t.unit_groups.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)})))))),r.a.createElement("th",null,"AVL"),r.a.createElement("th",null,"FC"),r.a.createElement("th",null,"CAD"),r.a.createElement("th",{className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,r.a.createElement(q,{unitcode:"",has_avl_device:!1,has_fc_device:!1,should_have_cad_location:!1,group_label:"",show_add_unit:s,cancel:function(){o(!1)}}),t.filtered_unit_data.map((function(e,t){return r.a.createElement(J,Object.assign({key:e.unitcode,index:t},e,{fetchData:E}))})))))},Q=a(7),W=function(e){var t=e.state_array,a=e.title,i=e.r,c=e.g,s=e.b,o=e.view_type,u=r.a.useContext(d),m=u.state,f=(u.dispatch,Object(n.useState)(null)),_=Object(l.a)(f,2),p=_[0],v=_[1],h=function(e,t){var a=(t.valueOf()-new Date(e).valueOf())/1e3;return a<60?1:a<120?.9:a<300?.8:a<600?.7:a<1200?.6:a<1800?.5:a<3600?.4:a<14400?.3:a<28800?.2:.1};return Object(n.useEffect)((function(){return m.map&&m[t].length>0&&Object(Q.loadModules)(["esri/layers/GraphicsLayer","esri/Graphic"]).then((function(e){var n=Object(l.a)(e,2),r=n[0],u=n[1],d=null===p?new r:p;d.graphics.length>0&&d.removeAll(),d.id=o,d.title=a;var f=new Date,_=!0,E=!1,w=void 0;try{for(var g,y=m[t][Symbol.iterator]();!(_=(g=y.next()).done);_=!0){var b=g.value,x={type:"point",longitude:b.longitude,latitude:b.latitude},N=new u({geometry:x,symbol:{type:"simple-marker",color:[i,c,s,h(b.location_timestamp,f)]}});N.setAttribute("view",o),N.setAttribute("device_id",b.device_id),N.setAttribute("unitcode",b.unitcode);var k=new u({geometry:x,symbol:{type:"text",color:"black",haloColor:"white",haloSize:"2px",xoffset:9,yoffset:-2,text:b.unitcode.length>0?b.unitcode:b.device_id,horizontalAlignment:"left",font:{size:10}}});d.add(N),d.add(k)}}catch(D){E=!0,w=D}finally{try{_||null==y.return||y.return()}finally{if(E)throw w}}v(d),m.map.add(d)})).catch((function(e){return console.error(e)})),function(){m.map&&m.map.remove(p)}}),[m.map,m[t]]),null},X=function(){var e=Object(n.useRef)(null),t=r.a.useContext(d).dispatch,a=function(e,a){t({type:"update_view",payload:{view:e,option:a}})},i=function(e,a,n,r){t({type:"update_view_device",payload:{view:e,unitcode:a,device_id:n,option:r}})};return Object(n.useEffect)((function(){Object(Q.loadModules)(["esri/Map","esri/views/MapView","esri/widgets/BasemapGallery","esri/widgets/LayerList","esri/widgets/Home","esri/layers/MapImageLayer"],{css:!0}).then((function(n){var r=Object(l.a)(n,6),c=r[0],s=r[1],o=r[2],u=r[3],d=r[4],m=r[5],f=new c({basemap:"streets-navigation-vector"}),_=new s({container:e.current,map:f,center:[-81.8,29.95],zoom:10,logo:!1},{logo:!1});new o({view:_,container:document.getElementById("basemap_selector_container"),source:{portal:{url:"http://www.arcgis.com",useVectorBasemaps:!0}}});var p=new m({url:"https://maps.claycountygov.com:6443/arcgis/rest/services/Fire_Response/MapServer",title:"Fire Services"});f.add(p);var v=new m({url:"https://maps.claycountygov.com:6443/arcgis/rest/services/SiteAddresses/MapServer",title:"Site Addresses"});f.add(v),new u({view:_,container:document.getElementById("layerlist_selector_container")});var h=new d({view:_});return _.ui.add(h,{position:"top-left"}),_.on("click",(function(e){_.hitTest(e).then((function(e){var t=["avl","fc","cad"];if(e.results.length){var n=e.results.filter((function(e){return t.indexOf(e.graphic.layer.id)>-1}))[0].graphic,r=n.attributes.view,c=r+"_view";"cad"===r?(a(c,{data_filter:n.attributes.unitcode,special_filter:""}),i(c,void 0,n.attributes.unitcode,{details:!0})):(a(c,{data_filter:n.attributes.device_id,special_filter:""}),i(c,n.attributes.device_id,void 0,{details:!0})),console.log(n.attributes)}}))})),_.when((function(){console.log("view.then running"),t({type:"save_map",payload:f}),t({type:"save_map_view",payload:_})})),function(){_&&(_.container=null)}}))}),[]),r.a.createElement("div",{className:"webmap",ref:e},r.a.createElement(W,{state_array:"filtered_avl_data",title:"AVL Units",r:"255",g:"0",b:"0",view_type:"avl"}),r.a.createElement(W,{state_array:"filtered_fc_data",title:"Fleet Complete Units",r:"0",g:"255",b:"0",view_type:"fc"}),r.a.createElement(W,{state_array:"filtered_cad_data",title:"CAD Units",r:"0",g:"0",b:"255",view_type:"cad"}))},Z=function(){function e(){Object(b.a)(this,e),this.label="",this.value=""}return Object(x.a)(e,null,[{key:"GetUnitGroups",value:function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(N("API/Group/GetUnitGroups"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}}]),e}();var $=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch,i=I(C.Get,"get_avl_data",!1).fetchData,c=I(F.Get,"get_fc_data",!1).fetchData,l=I(M.Get,"get_cad_data",!1).fetchData,s=I(R.Get,"get_unit_data",!1).fetchData;r.a.useEffect((function(){s(),i(),c(),l(),o()}),[]),function(e,t){var a=Object(n.useRef)(null);Object(n.useEffect)((function(){a.current=e}),[e]),Object(n.useEffect)((function(){if(null!==t){var e=setInterval((function(){a.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){console.log("automatically refreshing all"),s(),i(),c(),l(),o()}),6e4);var o=function(){var e;return g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(Z.GetUnitGroups());case 2:return e=t.sent,t.abrupt("return",a({type:"get_unit_groups_data",payload:e}));case 4:case"end":return t.stop()}}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(y,null),r.a.createElement("div",{className:"columns main-container is-mobile"},r.a.createElement("div",{style:{paddingRight:0},className:"column left-side ".concat("map"!==t.current_view?"is-full-mobile is-full-tablet is-full-desktop is-half-widescreen is-half-fullhd":"hide")},"avl"===t.current_view?r.a.createElement(V,null):null,"unit"===t.current_view?r.a.createElement(K,null):null,"fc"===t.current_view?r.a.createElement(P,null):null,"cad"===t.current_view?r.a.createElement(z,null):null),r.a.createElement("div",{style:{paddingLeft:0},className:"column right-side ".concat("map"!==t.current_view?"is-half-widescreen is-half-fullhd":"")},r.a.createElement(X,null))))};c.a.render(r.a.createElement((function(e){var t=Object(n.useReducer)(m,u),a=Object(l.a)(t,2),i=a[0],c=a[1];return r.a.createElement(d.Provider,{value:{state:i,dispatch:c}},e.children)}),null,r.a.createElement($,null)),document.getElementById("root"))}},[[10,1,2]]]);
//# sourceMappingURL=main.e8409ca1.chunk.js.map