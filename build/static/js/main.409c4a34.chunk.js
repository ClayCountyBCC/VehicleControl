(this.webpackJsonpvehiclecontrol=this.webpackJsonpvehiclecontrol||[]).push([[0],{15:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(7),c=a.n(l),i=a(3),s=a(2),o={avl_data:[],fleetcomplete_data:[],cad_data:[],unit_data:[],filtered_avl_data:[],filtered_fleetcomplete_data:[],filtered_cad_data:[],filtered_unit_data:[],avl_data_filter:"",fleetcomplete_data_filter:"",cad_data_filter:"",unit_data_filter:"",avl_data_sort_field:"device_id",fleetcomplete_data_sort_field:"",cad_data_sort_field:"",unit_data_sort_field:"",avl_data_sort_ascending:!0,fleetcomplete_data_sort_ascending:!0,cad_data_sort_ascending:!0,unit_data_sort_ascending:!0,avl_data_special_filter:"",fleetcomplete_data_special_filter:"",cad_data_special_filter:"",unit_data_special_filter:""},d=r.a.createContext(o);function u(e,t){switch(t.type){case"get_avl_data":return Object(s.a)({},e,{avl_data:t.payload,filtered_avl_data:m(t.payload,e.avl_data_filter,e.avl_data_sort_field,e.avl_data_sort_ascending,e.avl_data_special_filter)});case"search_avl_data":return Object(s.a)({},e,{filtered_avl_data:m(e.avl_data,t.payload,e.avl_data_sort_field,e.avl_data_sort_ascending,e.avl_data_special_filter),avl_data_filter:t.payload});case"avl_device_history":var a=e.filtered_avl_data.map((function(e){return e.device_id===t.payload.device_id&&(e.device_history=t.payload.device_history),e}));return Object(s.a)({},e,{filtered_avl_data:a});case"avl_data_special_filter":return Object(s.a)({},e,{filtered_avl_data:m(e.avl_data,e.avl_data_filter,e.avl_data_sort_field,e.avl_data_sort_ascending,t.payload),avl_data_special_filter:t.payload});case"avl_data_sort":var n=_(e.filtered_avl_data,t.payload,!e.avl_data_sort_ascending);return Object(s.a)({},e,{filtered_avl_data:n,avl_data_sort_field:t.payload,avl_data_sort_ascending:!e.avl_data_sort_ascending});case"avl_data_toggle_show_errors":var r=e.filtered_avl_data.map((function(e){return e.device_id===t.payload&&(e.show_errors=!e.show_errors),e}));return Object(s.a)({},e,{filtered_avl_data:r});case"avl_data_toggle_show_unit_options":var l=e.filtered_avl_data.map((function(e){return e.device_id===t.payload&&(e.show_unit_options=!e.show_unit_options),e}));return Object(s.a)({},e,{filtered_avl_data:l});default:return e}}function _(e,t,a){return["updated_on","location_timestamp"].indexOf(t)>-1?function(e,t,a){return e.sort((function(e,n){return new Date(e[t])>new Date(n[t])?a?1:-1:new Date(n[t])>new Date(e[t])?a?-1:1:0}))}(e,t,a):e.sort((function(e,n){return e[t]>n[t]?a?1:-1:n[t]>e[t]?a?-1:1:0}))}function m(e,t,a,n,r){return _(function(e,t){if(0===t.length)return e;switch(t){case"error":return e.filter((function(e){return e.error_information.length>0}));case"date":return e.filter((function(e){return e.has_date_error}));case"location":return e.filter((function(e){return e.has_location_error}));case"unit":return e.filter((function(e){return e.has_unit_error}));default:return e}}(function(e,t){if(0===t.length)return e;var a=t.toLowerCase();return e.filter((function(e){return e.device_id.toLowerCase().indexOf(a)>-1||e.unitcode.toLowerCase().indexOf(a)>-1}))}(e,t),r),a,n)}var v=a(1),p=a.n(v),f=function(){return r.a.createElement("nav",{className:"navbar is-primary",role:"navigation","aria-label":"main navigation"},r.a.createElement("div",{className:"navbar-brand"},r.a.createElement("h1",{className:"navbar-item is-size-3 has-text-weight-bold"},"Vehicle Control")),r.a.createElement("div",{className:"navbar-menu"},r.a.createElement("div",{className:"navbar-start"},r.a.createElement("p",{className:"navbar-item is-tab cursor_pointer"},"Units"),r.a.createElement("p",{className:"navbar-item is-tab is-active cursor_pointer"},"AVL"),r.a.createElement("p",{className:"navbar-item is-tab cursor_pointer"},"Fleet Complete"),r.a.createElement("p",{className:"navbar-item is-tab cursor_pointer"},"CAD")),r.a.createElement("div",{className:"navbar-end"},r.a.createElement("p",{className:"navbar-item"},"BaseMap"),r.a.createElement("p",{className:"navbar-item"},"Layers"))))},h=a(4),E=a(5);function y(e){var t;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.a.awrap(fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"}));case 2:if((t=a.sent).ok){a.next=5;break}throw new Error(t.statusText);case 5:return a.next=7,p.a.awrap(t.json());case 7:return a.abrupt("return",a.sent);case 8:case"end":return a.stop()}}))}function g(e,t){var a;return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.a.awrap(fetch(e,{method:"POST",body:null!==t?JSON.stringify(t):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}));case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}))}function b(e){return e instanceof Date?e.toLocaleString("en-us"):new Date(e).toLocaleString("en-US")}var w=function(){function e(){Object(h.a)(this,e),this.device_id="",this.device_type="",this.unitcode="",this.direction=0,this.location_timestamp=new Date,this.satellite_count=0,this.velocity=0,this.latitude=0,this.longitude=0,this.updated_on=new Date,this.error_information=[],this.show_unit_options=!1,this.show_errors=!1,this.has_date_error=!1,this.has_location_error=!1,this.has_unit_error=!1,this.device_history=[]}return Object(E.a)(e,null,[{key:"Get",value:function(){var e;return p.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.awrap(y("API/AVL/Get"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}))}},{key:"Delete",value:function(e){var t;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.a.awrap(g("API/AVL/Delete?device_id="+e,{}));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"Update",value:function(e,t,a){var n;return p.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,p.a.awrap(g("API/AVL/Update?device_id=".concat(e,"&device_type=").concat(t,"&unitcode=").concat(a),{}));case 2:return n=r.sent,r.abrupt("return",n);case 4:case"end":return r.stop()}}))}}]),e}(),N=function(e){return e.show_errors?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:e.colspan-1},r.a.createElement("ul",null,e.error_information.map((function(e,t){return r.a.createElement("li",{key:t},e)}))))):null},x=function(e){var t=Object(n.useState)(""),a=Object(i.a)(t,2),l=a[0],c=a[1];return e.show_unit_options?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{className:"has-text-right"},"Current Unit:"),r.a.createElement("td",null,0===e.unitcode.length?"None":e.unitcode),r.a.createElement("td",{className:"has-text-right"},"Change To:"),r.a.createElement("td",{colSpan:2},r.a.createElement("div",{className:"field has-addons"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input is-small",type:"text",onChange:function(e){return c(e.target.value)},value:l,placeholder:"New Unit"})),r.a.createElement("div",{className:"control"},r.a.createElement("button",{type:"button",onClick:function(t){return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),a.next=3,p.a.awrap(w.Update(e.device_id,e.device_type,l.trim()));case 3:a.sent.ok?e.fetch_avl_data():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return a.stop()}}))},className:"button is-success is-small"},"Save"))))):null},D=function(){function e(){Object(h.a)(this,e),this.id=-1,this.unitcode="",this.field="",this.changed_from="",this.changed_to="",this.changed_on=new Date,this.changed_by="",this.error_message=""}return Object(E.a)(e,null,[{key:"GetByUnit",value:function(e){var t;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.a.awrap(y("API/History/Unit?unitcode="+e));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}},{key:"GetByDeviceId",value:function(e){var t;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.a.awrap(y("API/History/DeviceId?deviceId="+e));case 2:return t=a.sent,a.abrupt("return",t);case 4:case"end":return a.stop()}}))}}]),e}(),C=function(e){return e.history&&0!==e.history.length?r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",{colSpan:e.colspan-1},r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"has-text-centered",colSpan:e.colspan},e.title)),r.a.createElement("tr",null,r.a.createElement("th",null,"Unitcode"),r.a.createElement("th",null,"Field"),r.a.createElement("th",null,"Changed From"),r.a.createElement("th",null,"Changed To"),r.a.createElement("th",null,"Changed On"),r.a.createElement("th",null,"Changed By"))),r.a.createElement("tbody",null,e.history.map((function(e){return e.error_message.length>0?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:6},e.error_message)):r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,e.unitcode),r.a.createElement("td",null,e.field),r.a.createElement("td",null,e.changed_from),r.a.createElement("td",null,e.changed_to),r.a.createElement("td",null,b(e.changed_on)),r.a.createElement("td",null,e.changed_by))})))))):null},k=function(e){var t=r.a.useContext(d).dispatch,a=function(){var e;return p.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.a.awrap(w.Get());case 2:return e=a.sent,a.abrupt("return",t({type:"get_avl_data",payload:e}));case 4:case"end":return a.stop()}}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,e.index+1),r.a.createElement("td",null,e.device_id),r.a.createElement("td",null,r.a.createElement("span",{className:"icon"},r.a.createElement("i",{className:"fas ".concat("Phone Number"===e.device_type?"fa-phone":"fa-mobile-alt")}))),r.a.createElement("td",null,r.a.createElement("span",{title:"Change this Device's unit",className:"cursor_pointer has-text-link",onClick:function(a){t({type:"avl_data_toggle_show_unit_options",payload:e.device_id})}},0===e.unitcode.length?"Add":e.unitcode)),r.a.createElement("td",null,b(e.updated_on)),r.a.createElement("td",null,b(e.location_timestamp)),r.a.createElement("td",{style:{paddingRight:"1em"},className:"has-text-right"},e.error_information.length>0?r.a.createElement("span",{title:"View Errors",className:"icon cursor_pointer has-text-warning",onClick:function(a){t({type:"avl_data_toggle_show_errors",payload:e.device_id})}},r.a.createElement("i",{className:"fas fa-exclamation-circle"})):"",r.a.createElement("span",{title:"View History",className:"icon cursor_pointer has-text-link",style:{marginLeft:"1em"},onClick:function(a){var n;return p.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(a.preventDefault(),e.device_history&&0!==e.device_history.length){r.next=8;break}return r.next=4,p.a.awrap(D.GetByDeviceId(e.device_id));case 4:n=r.sent,t({type:"avl_device_history",payload:{device_id:e.device_id,device_history:n}}),r.next=9;break;case 8:t({type:"avl_device_history",payload:{device_id:e.device_id,device_history:[]}});case 9:case"end":return r.stop()}}))}},r.a.createElement("i",{className:"fas fa-history"})),r.a.createElement("span",{title:"Delete This Device",className:"icon cursor_pointer has-text-danger",style:{marginLeft:"1em"},onClick:function(t){return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t.preventDefault(),n.next=3,p.a.awrap(w.Delete(e.device_id));case 3:n.sent.ok?a():alert("There was a problem with deleting this record. Please contact MIS Development for more information.");case 5:case"end":return n.stop()}}))}},r.a.createElement("i",{className:"fas fa-trash-alt"})))),r.a.createElement(x,Object.assign({colspan:6,new_unitcode:"",fetch_avl_data:a},e)),r.a.createElement(N,{colspan:6,error_information:e.error_information,show_errors:e.show_errors}),r.a.createElement(C,{colspan:6,title:"History By Device Id",history:e.device_history}))},O=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch;return r.a.createElement("section",null,r.a.createElement("div",{style:{padding:"1em",marginBottom:0},className:"level"},r.a.createElement("div",{className:"level-left"},r.a.createElement("div",{className:"level-item is-size-3 has-text-weight-bold"},"AVL"),r.a.createElement("div",{className:"level-item"},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{title:"Search for text in the Device Id and Unit fields.  Hit Enter to Search.",type:"text",placeholder:"Search",onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),a({type:"search_avl_data",payload:e.target.value}))}})))),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(e){e.preventDefault(),function(){var e;p.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.awrap(w.Get());case 2:return e=t.sent,t.abrupt("return",a({type:"get_avl_data",payload:e}));case 4:case"end":return t.stop()}}))}()},title:"Refresh the AVL Data",type:"button",className:"button is-success is-small"},r.a.createElement("span",{className:"icon is-small"},r.a.createElement("i",{className:"fas fa-sync-alt"}))))),r.a.createElement("div",{className:"level-right"},r.a.createElement("p",{className:"level-item has-text-weight-bold"},"Error Filters"),r.a.createElement("div",{className:"level-item tabs"},r.a.createElement("ul",null,r.a.createElement("li",{className:"".concat(""===t.avl_data_special_filter?"is-active":"")},r.a.createElement("a",{href:"#NoFilter",onClick:function(e){a({type:"avl_data_special_filter",payload:""})}},"Show All")),r.a.createElement("li",{className:"".concat("error"===t.avl_data_special_filter?"is-active":"")},r.a.createElement("a",{href:"#AllErrors",onClick:function(e){a({type:"avl_data_special_filter",payload:"error"})}},"Errors Only")),r.a.createElement("li",{className:"".concat("unit"===t.avl_data_special_filter?"is-active":"")},r.a.createElement("a",{href:"#UnitErrors",onClick:function(e){a({type:"avl_data_special_filter",payload:"unit"})}},"Unit")),r.a.createElement("li",{className:"".concat("date"===t.avl_data_special_filter?"is-active":"")},r.a.createElement("a",{href:"#DateErrors",onClick:function(e){a({type:"avl_data_special_filter",payload:"date"})}},"Date")),r.a.createElement("li",{className:"".concat("location"===t.avl_data_special_filter?"is-active":"")},r.a.createElement("a",{href:"#LocationErrors",onClick:function(e){a({type:"avl_data_special_filter",payload:"location"})}},"Location")))))),r.a.createElement("table",{className:"table is-fullwidth"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"#"),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDeviceId",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"device_id"})},className:"".concat("device_id"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Device Id")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDeviceType",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"device_type"})},className:"".concat("device_type"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Type")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByUnit",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"unitcode"})},className:"".concat("unitcode"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Unit")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByDateSavedOn",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"updated_on"})},className:"".concat("updated_on"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Data Saved On")),r.a.createElement("th",null,r.a.createElement("a",{href:"#SortByLocationDate",onClick:function(e){e.preventDefault(),a({type:"avl_data_sort",payload:"location_timestamp"})},className:"".concat("location_timestamp"!==t.avl_data_sort_field?"":t.avl_data_sort_ascending?"sort_ascending":"sort_descending")},"Location On")),r.a.createElement("th",{className:"has-text-centered"},"Options"))),r.a.createElement("tbody",null,t.filtered_avl_data.map((function(e,t){return r.a.createElement(k,Object.assign({key:e.device_id,index:t},e))})))))},S=a(8),j=function(){var e=Object(n.useRef)(null);return Object(n.useEffect)((function(){Object(S.loadModules)(["esri/Map","esri/views/MapView"],{css:!0}).then((function(t){var a=Object(i.a)(t,2),n=a[0],r=a[1],l=new n({basemap:"osm"}),c=new r({container:e.current,map:l,center:[-81.8,29.95],zoom:11});return function(){c&&(c.container=null)}}))})),r.a.createElement("div",{className:"webmap",ref:e})},L=function(){var e=r.a.useContext(d),t=e.state,a=e.dispatch;r.a.useEffect((function(){0===t.avl_data.length&&n()}),[]);var n=function(){var e;return p.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.awrap(w.Get());case 2:return e=t.sent,t.abrupt("return",a({type:"get_avl_data",payload:e}));case 4:case"end":return t.stop()}}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(f,null),r.a.createElement("div",{className:"columns main-container"},r.a.createElement("div",{style:{paddingRight:0},className:"column is-half left-side"},r.a.createElement(O,null)),r.a.createElement("div",{style:{paddingLeft:0},className:"column is-half right-side"},r.a.createElement(j,null))))};c.a.render(r.a.createElement((function(e){var t=Object(n.useReducer)(u,o),a=Object(i.a)(t,2),l=a[0],c=a[1];return r.a.createElement(d.Provider,{value:{state:l,dispatch:c}},e.children)}),null,r.a.createElement(L,null)),document.getElementById("root"))},9:function(e,t,a){e.exports=a(15)}},[[9,1,2]]]);
//# sourceMappingURL=main.409c4a34.chunk.js.map